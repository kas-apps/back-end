# Lesson 01: ファイル操作 - 演習問題 💪

このレッスンで学んだファイル操作の知識を使って、実際に手を動かそう！

---

## 📝 演習の進め方

1. **基礎編**から始めよう（必須）
2. **応用編**にチャレンジ（推奨）
3. **セキュリティチャレンジ**で脆弱性修正を学ぶ（超重要！）
4. **総合チャレンジ**で創造性を発揮（任意）

**ヒント**：わからない場合は、AIに質問してみよう！
でも、**セキュリティ対策を忘れずに指示すること**が超重要！

---

## 🌱 基礎編（必須）

### 演習 01-01: テキストファイルの読み込み

**課題**：

`resources/sample.txt` ファイルを読み込んで、ブラウザに表示するPHPコードを書こう。

**要件**：

- `file_get_contents()` を使う
- ファイルが存在しない場合は、「ファイルが見つかりません」と表示
- XSS対策として `htmlspecialchars()` を使う
- 改行を保持して表示（`nl2br()` を使う）

**期待する出力**：

```text
これはサンプルテキストファイルです。
2行目の内容です。
3行目の内容です。
```

**AIへの指示例**：

```text
「resources/sample.txtファイルをfile_get_contents()で読み込んで表示するPHPコードを書いてください。
ファイルが存在しない場合のエラーハンドリング、XSS対策（htmlspecialchars）、改行の保持（nl2br）を含めてください。」
```

👉 **[解答例を見る](solutions/README.md#演習-01-01-テキストファイルの読み込み)**

---

### 演習 01-02: テキストファイルへの書き込み

**課題**：

ユーザーが入力した内容を `data/memo.txt` に保存するプログラムを作ろう。

**要件**：

- HTMLフォームで入力を受け取る
- `file_put_contents()` を使ってファイルに書き込む
- `data` ディレクトリが存在しない場合は作成する
- 書き込み成功後、「保存しました」と表示

**ファイル構成**：

```text
01-02-memo-form.html  ← フォーム
01-02-memo-save.php   ← 保存処理
```

**AIへの指示例**：

```text
「HTMLフォームでメモの内容を入力し、PHPでdata/memo.txtに保存するコードを書いてください。
ディレクトリが存在しない場合はmkdir()で作成してください。」
```

👉 **[解答例を見る](solutions/README.md#演習-01-02-テキストファイルへの書き込み)**

---

### 演習 01-03: ディレクトリ内のファイル一覧表示

**課題**：

`data` ディレクトリ内のファイルとフォルダを一覧表示しよう。

**要件**：

- `scandir()` を使う
- `.` と `..` は表示しない
- ファイルとディレクトリを区別して表示（`is_dir()` を使う）
- XSS対策として `htmlspecialchars()` を使う

**期待する出力**：

```text
data ディレクトリの内容：
[DIR] images
[FILE] memo.txt
[FILE] sample.csv
```

👉 **[解答例を見る](solutions/README.md#演習-01-03-ディレクトリ内のファイル一覧表示)**

---

## 🚀 応用編（推奨）

### 演習 01-04: CSVファイルの読み込みとHTMLテーブル表示

**課題**：

`resources/products.csv` を読み込んで、HTMLテーブルで表示しよう。

**CSVの内容**：

```csv
商品名,価格,在庫
りんご,120,50
バナナ,80,30
オレンジ,150,20
```

**要件**：

- `fopen()` + `fgetcsv()` を使う
- 1行目をヘッダー（`<th>`）として表示
- 2行目以降をデータ（`<td>`）として表示
- XSS対策として `htmlspecialchars()` を使う
- ファイルが存在しない場合のエラーハンドリング

**期待する出力**：

HTMLテーブルで：

| 商品名   | 価格 | 在庫 |
| -------- | ---- | ---- |
| りんご   | 120  | 50   |
| バナナ   | 80   | 30   |
| オレンジ | 150  | 20   |

👉 **[解答例を見る](solutions/README.md#演習-01-04-csvファイルの読み込みとhtmlテーブル表示)**

---

### 演習 01-05: CSVファイルのエクスポート

**課題**：

配列データをCSVファイルとしてエクスポートしよう。

**データ**：

```php
$users = [
    ["name" => "山田太郎", "age" => 25, "email" => "taro@example.com"],
    ["name" => "佐藤花子", "age" => 30, "email" => "hanako@example.com"],
    ["name" => "鈴木一郎", "age" => 28, "email" => "ichiro@example.com"]
];
```

**要件**：

- `fopen()` + `fputcsv()` を使う
- ヘッダー行を含める（名前、年齢、メール）
- `data/users.csv` に保存
- 保存成功後、「CSVファイルを作成しました」と表示

👉 **[解答例を見る](solutions/README.md#演習-01-05-csvファイルのエクスポート)**

---

## 🔒 セキュリティチャレンジ（超重要！）

### 演習 01-06: パストラバーサル脆弱性の修正

**課題**：

以下の**脆弱なコード**を修正して、セキュアにしよう。

**脆弱なコード**：

```php
<?php
// 🚨 危険：パストラバーサル攻撃に脆弱
$filename = $_GET['file'];
$content = file_get_contents("data/" . $filename);
echo $content;
?>
```

**攻撃例**：

```text
?file=../../config/database.php
→ 本来見えてはいけないファイルが読まれる！
```

**修正要件**：

1. `basename()` でディレクトリ部分を除去
2. ホワイトリストで許可されたファイルのみアクセス可能にする
3. XSS対策として `htmlspecialchars()` を使う
4. ファイルが存在しない、または許可されていない場合はエラーメッセージを表示

**許可するファイル**：

- `memo.txt`
- `sample.txt`
- `log.txt`

👉 **[解答例を見る](solutions/README.md#演習-01-06-パストラバーサル脆弱性の修正)**

---

### 演習 01-07: セキュアなファイルアップロード

**課題**：

画像ファイル（JPEG、PNG）のみをアップロードできる、セキュアなアップロードシステムを作ろう。

**要件**：

1. **ファイルサイズ制限**：最大2MBまで
2. **ファイルタイプチェック**：MIMEタイプで確認（`image/jpeg`、`image/png` のみ）
3. **拡張子チェック**：`jpg`、`jpeg`、`png` のみ
4. **ファイル名のサニタイズ**：`basename()` を使う
5. **ユニークなファイル名**：`uniqid()` で生成して上書きを防止
6. **アップロード先**：`uploads/` ディレクトリ（存在しない場合は作成）
7. **エラーハンドリング**：各種エラーに対応

**ファイル構成**：

```text
01-07-upload-form.html  ← アップロードフォーム
01-07-upload.php        ← アップロード処理
```

**セキュリティチェックリスト**：

- [ ] ファイルサイズ制限
- [ ] MIMEタイプチェック
- [ ] 拡張子チェック
- [ ] ファイル名のサニタイズ
- [ ] ユニークなファイル名生成
- [ ] XSS対策（ファイル名を表示する際）

👉 **[解答例を見る](solutions/README.md#演習-01-07-セキュアなファイルアップロード)**

---

## 🏆 総合チャレンジ（任意）

### 演習 01-08: 簡易ブログシステム（ファイルベース）

**課題**：

データベースを使わず、ファイルだけで動く簡易ブログシステムを作ろう！

**機能**：

1. **記事一覧表示**：`data/posts/` ディレクトリ内のテキストファイルを一覧表示
2. **記事詳細表示**：ファイルの内容を表示
3. **新規記事作成**：フォームから記事を投稿して、ファイルに保存
4. **記事削除**：指定した記事ファイルを削除

**技術要件**：

- ファイル名は `YYYYMMDD_HHMMSS.txt` 形式（タイムスタンプ）
- ファイルの1行目がタイトル、2行目以降が本文
- セキュリティ対策（パストラバーサル、XSS、ファイル名サニタイズ）をすべて実装

**ファイル構成**：

```text
01-08-blog-index.php    ← 記事一覧
01-08-blog-view.php     ← 記事詳細
01-08-blog-create.php   ← 新規作成フォーム
01-08-blog-save.php     ← 保存処理
01-08-blog-delete.php   ← 削除処理
```

**チャレンジポイント**：

- AIと一緒に設計から始めよう！
- セキュリティを最初から組み込もう！
- コードを段階的に作っていこう（一気に全部作ろうとしない）

👉 **[解答例を見る](solutions/README.md#演習-01-08-簡易ブログシステムファイルベース)**

---

## 🎯 演習を終えたら

### 自己チェックリスト

- [ ] ファイルの読み込み（`file_get_contents`、`fopen`）ができる
- [ ] ファイルの書き込み（`file_put_contents`、`fwrite`）ができる
- [ ] CSVファイルの読み書き（`fgetcsv`、`fputcsv`）ができる
- [ ] ディレクトリ操作（`mkdir`、`scandir`）ができる
- [ ] ファイルアップロードの実装ができる
- [ ] **パストラバーサル対策**ができる
- [ ] **ファイルタイプチェック**ができる
- [ ] **セキュアなファイル操作**の習慣が身についた

### 次のステップ

すべての演習を終えたら、**Lesson 02: セッション管理**に進もう！

---

**Let's vibe and code! 🎉**

ファイル操作をマスターして、セキュアなコードを書けるようになったね！✨
