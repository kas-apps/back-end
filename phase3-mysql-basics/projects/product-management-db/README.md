# 総合プロジェクト2: Product Management Database 📦

**学習目標**：Phase 3で学んだMySQL基礎をすべて使って、商品管理システムのデータベースを設計・実装する！

---

## 📖 プロジェクト概要

このプロジェクトでは、**商品管理システムのデータベース**を作成します。

カテゴリ、仕入先、商品の3つのテーブルを持ち、複数の1対多の関係を実践するデータベースを設計・実装するよ！

---

## 🎯 学べること

- 複数の1対多の関係を持つデータベース設計
- 適切なデータ型の選択（特に価格・在庫のDECIMAL、INT）
- 外部キー制約の実践
- 実用的なクエリ（在庫管理、価格計算）
- ビジネスロジックとデータベース設計の関連性

---

## 🏗️ 機能要件

### カテゴリ管理

- カテゴリ情報を格納
- カテゴリ名、説明を管理
- カテゴリ名は一意（重複不可）

### 仕入先管理

- 仕入先情報を格納
- 仕入先名、連絡先（メール、電話）を管理
- 仕入先名は一意（重複不可）

### 商品管理

- 商品情報を格納
- 商品名、価格、在庫数、商品コードを管理
- 商品は必ずカテゴリに属する
- 商品は必ず仕入先に紐づく
- 商品コードは一意（重複不可）

---

## 📊 テーブル設計

### ER図（テーブル間の関係）

```text
categories（1つのカテゴリ）
   ↓ 1対多
products（複数の商品）

suppliers（1つの仕入先）
   ↓ 1対多
products（複数の商品）

つまり：
- 1つのカテゴリには複数の商品が属する
- 1つの仕入先は複数の商品を供給する
- 1つの商品は1つのカテゴリに属し、1つの仕入先から仕入れる
```

### categoriesテーブル

カテゴリ情報を格納するテーブル。

| カラム名    | データ型      | 制約                        | 説明           |
| ----------- | ------------- | --------------------------- | -------------- |
| id          | INT           | PRIMARY KEY, AUTO_INCREMENT | カテゴリID     |
| name        | VARCHAR(100)  | UNIQUE, NOT NULL            | カテゴリ名     |
| description | TEXT          | NULL                        | カテゴリ説明   |

**主キー**：`id`

### suppliersテーブル

仕入先情報を格納するテーブル。

| カラム名 | データ型     | 制約                        | 説明           |
| -------- | ------------ | --------------------------- | -------------- |
| id       | INT          | PRIMARY KEY, AUTO_INCREMENT | 仕入先ID       |
| name     | VARCHAR(200) | UNIQUE, NOT NULL            | 仕入先名       |
| email    | VARCHAR(255) | NULL                        | メールアドレス |
| phone    | VARCHAR(20)  | NULL                        | 電話番号       |

**主キー**：`id`

### productsテーブル

商品情報を格納するテーブル。

| カラム名    | データ型       | 制約                                 | 説明                     |
| ----------- | -------------- | ------------------------------------ | ------------------------ |
| id          | INT            | PRIMARY KEY, AUTO_INCREMENT          | 商品ID                   |
| category_id | INT            | NOT NULL, FOREIGN KEY                | カテゴリID（外部キー）   |
| supplier_id | INT            | NOT NULL, FOREIGN KEY                | 仕入先ID（外部キー）     |
| name        | VARCHAR(200)   | NOT NULL                             | 商品名                   |
| sku         | VARCHAR(50)    | UNIQUE, NOT NULL                     | 商品コード（SKU）        |
| price       | DECIMAL(10, 2) | NOT NULL                             | 価格                     |
| stock       | INT            | DEFAULT 0                            | 在庫数                   |
| created_at  | TIMESTAMP      | DEFAULT CURRENT_TIMESTAMP            | 登録日時                 |

**主キー**：`id`

**外部キー**：

- `category_id` → `categories(id)`を参照
- `supplier_id` → `suppliers(id)`を参照

**重要なポイント**：

- **価格はDECIMAL(10, 2)**：小数点以下2桁まで正確に保存（FLOAT/DOUBLEは誤差が出る）
- **在庫数はINT**：整数で管理
- **SKU（Stock Keeping Unit）**：商品を一意に識別するコード（商品コード）

---

## 💻 実装

### データベースとテーブルの作成

完全なSQL定義は`database.sql`を参照してください。

👉 **[database.sqlを見る](database.sql)**

### phpMyAdminでの実行手順

1. **phpMyAdminにアクセス**
   - MAMP起動後、ブラウザで`http://localhost:8888/phpMyAdmin/`にアクセス

2. **database.sqlの内容をコピー**
   - `database.sql`ファイルの内容を全てコピー

3. **SQLタブで実行**
   - phpMyAdminで「SQL」タブをクリック
   - コピーしたSQLをペースト
   - 「実行」ボタンをクリック

4. **確認**
   - 左側のデータベース一覧から`product_db`を選択
   - `categories`、`suppliers`、`products`テーブルが作成されているか確認
   - 各テーブルをクリックして、サンプルデータが挿入されているか確認

---

## 🔍 サンプルデータ

### categories（5つのカテゴリ）

| id  | name     | description                  |
| --- | -------- | ---------------------------- |
| 1   | 家電     | 家電製品全般                 |
| 2   | 食品     | 食品・飲料                   |
| 3   | 書籍     | 書籍・雑誌                   |
| 4   | 文房具   | 文房具・オフィス用品         |
| 5   | スポーツ | スポーツ・アウトドア用品     |

### suppliers（3つの仕入先）

| id  | name           | email                   | phone          |
| --- | -------------- | ----------------------- | -------------- |
| 1   | テクノサプライ | <info@techno-supply.com>  | 03-1234-5678   |
| 2   | フードマート   | <contact@foodmart.com>    | 03-2345-6789   |
| 3   | ユニバーサル商事 | <sales@universal-trade.com> | 03-3456-7890   |

### products（10件の商品）

| id  | category_id | supplier_id | name             | sku       | price     | stock |
| --- | ----------- | ----------- | ---------------- | --------- | --------- | ----- |
| 1   | 1           | 1           | ノートパソコン   | LAPTOP001 | 85000.00  | 15    |
| 2   | 1           | 1           | スマートフォン   | PHONE001  | 65000.00  | 20    |
| 3   | 1           | 1           | タブレット       | TABLET001 | 45000.00  | 10    |
| 4   | 2           | 2           | コーヒー豆（500g）| COFFEE001 | 1500.00   | 50    |
| 5   | 2           | 2           | 緑茶（100g）     | TEA001    | 800.00    | 100   |
| 6   | 3           | 3           | PHP入門書        | BOOK001   | 3000.00   | 30    |
| 7   | 3           | 3           | MySQL完全ガイド  | BOOK002   | 3500.00   | 25    |
| 8   | 4           | 3           | ボールペン（12本）| PEN001    | 600.00    | 200   |
| 9   | 4           | 3           | ノート（5冊）    | NOTE001   | 800.00    | 150   |
| 10  | 5           | 1           | ランニングシューズ | SHOES001  | 12000.00  | 40    |

---

## 💪 実践課題

データベースを作成したら、以下の課題にチャレンジしよう！

### 課題1: 基本的なSELECT

以下のデータを取得するSQLを書いてください：

1. 全カテゴリを取得
2. 全仕入先を取得
3. 全商品を取得
4. 特定のカテゴリ（家電）の商品を取得
5. 特定の仕入先（テクノサプライ）の商品を取得
6. 価格が10000円以上の商品を取得
7. 在庫が50個以下の商品を取得

### 課題2: データの挿入

以下のデータを挿入してください：

1. 新しいカテゴリを追加（name: "玩具", description: "玩具・ゲーム"）
2. 新しい仕入先を追加（name: "トイズカンパニー", email: "<info@toys.com>", phone: "03-4567-8901"）
3. 新しい商品を追加（category_id: 6（玩具）, supplier_id: 4（トイズカンパニー）, name: "パズル", sku: "TOY001", price: 2500.00, stock: 30）

### 課題3: データの更新

以下のデータを更新してください：

1. 商品「ノートパソコン」の価格を80000.00円に値下げ
2. 商品「コーヒー豆（500g）」の在庫を30個に更新
3. 仕入先「フードマート」のメールアドレスを「<info@foodmart.com>」に変更

### 課題4: データの削除

以下のデータを削除してください：

1. 商品「タブレット」を削除
2. カテゴリ「スポーツ」に属する全ての商品を削除

**注意**：外部キー制約があるため、参照されているデータは削除できません。先に参照している側（products）を削除してから、参照される側（categoriesやsuppliers）を削除する必要があります。

### 課題5: 高度なクエリ

以下のデータを取得するSQLを書いてください：

1. 価格が高い順に商品を表示
2. 在庫が少ない順に商品を表示（在庫管理に便利）
3. カテゴリ別の商品数をカウント（ヒント：Phase 4で学ぶGROUP BY）
4. 仕入先別の商品の平均価格を計算（ヒント：Phase 4で学ぶGROUP BY、AVG）

### 課題6: ビジネスロジック

以下の実用的なクエリを考えてください：

1. 在庫が10個以下の商品を「在庫不足」として警告表示
2. 商品の合計在庫数を計算
3. 商品の合計金額（価格×在庫数）を計算
4. 最も高い商品と最も安い商品を取得

---

## 🤖 バイブコーディング実践

### AIに指示を出してみよう

このプロジェクトをAIと一緒に作る場合の指示例：

**良い指示の例**：

```text
「商品管理システムのデータベースを設計してください。

以下の3つのテーブルが必要です：

1. categoriesテーブル（カテゴリ情報）
   - id（主キー、自動増分）
   - name（カテゴリ名、必須、一意、最大100文字）
   - description（説明、TEXT型、NULL可）

2. suppliersテーブル（仕入先情報）
   - id（主キー、自動増分）
   - name（仕入先名、必須、一意、最大200文字）
   - email（メールアドレス、最大255文字、NULL可）
   - phone（電話番号、最大20文字、NULL可）

3. productsテーブル（商品情報）
   - id（主キー、自動増分）
   - category_id（外部キー、categoriesテーブルのidを参照、必須）
   - supplier_id（外部キー、suppliersテーブルのidを参照、必須）
   - name（商品名、必須、最大200文字）
   - sku（商品コード、必須、一意、最大50文字）
   - price（価格、DECIMAL(10, 2)型、必須）
   - stock（在庫数、INT型、デフォルト：0）
   - created_at（登録日時、デフォルト：現在時刻）

テーブル間の関係：
- 1つのカテゴリ → 複数の商品（1対多）
- 1つの仕入先 → 複数の商品（1対多）

重要ポイント：
- 価格はDECIMAL型を使用（正確な小数が必要）
- SKUは商品を一意に識別するコード

MySQLのCREATE TABLE文で出力してください。
データベース名は「product_db」を使用してください。」
```

### 生成されたSQLのチェックポイント

- [ ] **データベースの作成**
  - `CREATE DATABASE`文があるか
  - 文字コード設定（utf8mb4）があるか

- [ ] **主キーの設定**
  - 全テーブルに`id`カラム（PRIMARY KEY、AUTO_INCREMENT）があるか

- [ ] **外部キーの設定**
  - `products.category_id` → `categories.id`の参照があるか
  - `products.supplier_id` → `suppliers.id`の参照があるか

- [ ] **制約の設定**
  - NOT NULL：必須項目に設定されているか
  - UNIQUE：name、skuに設定されているか
  - DEFAULT：stock、created_atに設定されているか

- [ ] **データ型の選択**
  - **価格**：DECIMAL(10, 2)が使われているか（FLOAT/DOUBLEは誤差が出るのでNG）
  - **在庫数**：INTが使われているか
  - VARCHAR：適切な長さが設定されているか
  - TEXT：長い文字列（説明）に使われているか
  - TIMESTAMP：日時に使われているか

### よくある問題と修正方法

#### 問題1: 価格にFLOATを使用

**悪い例（AIが生成しがち）**：

```sql
price FLOAT NOT NULL
```

**問題点**：FLOATは浮動小数点型で、誤差が発生する可能性がある。価格計算で誤差は致命的！

**修正**：

```sql
price DECIMAL(10, 2) NOT NULL  -- 小数点以下2桁まで正確に保存
```

**AIへの修正指示**：

```text
「価格のデータ型をFLOATからDECIMAL(10, 2)に変更してください。
FLOATは浮動小数点で誤差が出るため、価格には不適切です。
DECIMAL(10, 2)を使うと、小数点以下2桁まで正確に保存できます。」
```

#### 問題2: 在庫数のデフォルト値がない

**悪い例**：

```sql
stock INT NOT NULL
```

**問題点**：新規商品登録時に在庫数を必ず指定しないといけない。デフォルト値があると便利！

**修正**：

```sql
stock INT DEFAULT 0
```

**AIへの修正指示**：

```text
「stockカラムにデフォルト値0を設定してください。
新規商品登録時に在庫数を省略した場合、0が自動設定されるようにします。」
```

---

## ✅ まとめ

このプロジェクトで学んだこと：

- ✅ 複数の1対多の関係を持つデータベース設計
- ✅ 適切なデータ型の選択（DECIMAL、INT、VARCHAR、TEXT）
- ✅ 外部キー制約の実践（複数の外部キー）
- ✅ 実用的なビジネスロジックとデータベース設計の関連性
- ✅ 在庫管理、価格計算などの実用的なクエリ

---

## 🚀 次のステップ

おめでとう！商品管理システムのデータベースを作成できたね！✨

Phase 3のすべてのレッスンとプロジェクトを修了したら、次は：

- **Phase 4: MySQL発展編**に進んで、JOIN、集計関数、トランザクションを学ぶ
- **Phase 5: PHP+MySQL統合編**に進んで、PHPからデータベースを操作する

👉 **[Phase 3のREADMEに戻る](../../README.md)**

---

**Let's vibe and code! 🎉**

Phase 3で学んだMySQL基礎を使って、実用的なデータベースを設計できるようになったね！
