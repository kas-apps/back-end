# Lesson 05: ãƒšãƒ¼ã‚¸ãƒ³ã‚°å‡¦ç† - è§£ç­”ä¾‹ ğŸ“„

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€Lesson 05ã®ã™ã¹ã¦ã®æ¼”ç¿’å•é¡Œã®è©³ç´°ãªè§£ç­”ä¾‹ã¨è§£èª¬ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

---

## ç›®æ¬¡

- [åŸºç¤ç·¨](#åŸºç¤ç·¨)
  - [å•é¡Œ5-1: åŸºæœ¬çš„ãªãƒšãƒ¼ã‚¸ãƒ³ã‚°å‡¦ç†](#å•é¡Œ5-1åŸºæœ¬çš„ãªãƒšãƒ¼ã‚¸ãƒ³ã‚°å‡¦ç†)
  - [å•é¡Œ5-2: ç·ãƒšãƒ¼ã‚¸æ•°ã®è¨ˆç®—](#å•é¡Œ5-2ç·ãƒšãƒ¼ã‚¸æ•°ã®è¨ˆç®—)
  - [å•é¡Œ5-3: ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã®è¡¨ç¤º](#å•é¡Œ5-3ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã®è¡¨ç¤º)
- [å¿œç”¨ç·¨](#å¿œç”¨ç·¨)
  - [å•é¡Œ5-4: çœç•¥è¡¨ç¤ºï¼ˆ...ï¼‰ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³](#å•é¡Œ5-4çœç•¥è¡¨ç¤ºã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³)
  - [å•é¡Œ5-5: 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°ã‚’å¤‰æ›´å¯èƒ½ã«ã™ã‚‹](#å•é¡Œ5-51ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°ã‚’å¤‰æ›´å¯èƒ½ã«ã™ã‚‹)
  - [å•é¡Œ5-6: æ¤œç´¢çµæœã®ãƒšãƒ¼ã‚¸ãƒ³ã‚°](#å•é¡Œ5-6æ¤œç´¢çµæœã®ãƒšãƒ¼ã‚¸ãƒ³ã‚°)
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ£ãƒ¬ãƒ³ã‚¸](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ£ãƒ¬ãƒ³ã‚¸)
  - [å•é¡Œ5-7: ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ä»˜ããƒšãƒ¼ã‚¸ãƒ³ã‚°](#å•é¡Œ5-7ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ä»˜ããƒšãƒ¼ã‚¸ãƒ³ã‚°)
  - [å•é¡Œ5-8: ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã®ä½œæˆ](#å•é¡Œ5-8ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã®ä½œæˆ)
- [ç·åˆãƒãƒ£ãƒ¬ãƒ³ã‚¸](#ç·åˆãƒãƒ£ãƒ¬ãƒ³ã‚¸)
  - [å•é¡Œ5-9: å®Œå…¨ãªè¨˜äº‹æ¤œç´¢ãƒ»ä¸€è¦§ã‚·ã‚¹ãƒ†ãƒ ](#å•é¡Œ5-9å®Œå…¨ãªè¨˜äº‹æ¤œç´¢ä¸€è¦§ã‚·ã‚¹ãƒ†ãƒ )
  - [å•é¡Œ5-10: ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«](#å•é¡Œ5-10ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«)

---

## åŸºç¤ç·¨

### å•é¡Œ5-1ï¼šåŸºæœ¬çš„ãªãƒšãƒ¼ã‚¸ãƒ³ã‚°å‡¦ç†

è¨˜äº‹ä¸€è¦§ã«åŸºæœ¬çš„ãªãƒšãƒ¼ã‚¸ãƒ³ã‚°å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ï¼ˆ1ãƒšãƒ¼ã‚¸10ä»¶è¡¨ç¤ºï¼‰ã€‚

#### âœ… è§£ç­”ä¾‹

**pagination_basic.php**

```php
<?php
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
$host = 'localhost';
$port = '8889';
$dbname = 'phase5_practice';
$username = 'root';
$password = 'root';

try {
    $pdo = new PDO(
        "mysql:host=$host;port=$port;dbname=$dbname;charset=utf8mb4",
        $username,
        $password,
        [
            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
            PDO::ATTR_EMULATE_PREPARES => false
        ]
    );
} catch (PDOException $e) {
    die('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼: ' . htmlspecialchars($e->getMessage(), ENT_QUOTES, 'UTF-8'));
}

// ãƒšãƒ¼ã‚¸ç•ªå·ã‚’å–å¾—
$current_page = $_GET['page'] ?? 1;
$current_page = (int)$current_page;

// ä¸æ­£ãªå€¤ã®ãƒã‚§ãƒƒã‚¯
if ($current_page < 1) {
    // ãƒšãƒ¼ã‚¸1ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    header('Location: ?page=1');
    exit;
}

// 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°
$per_page = 10;

// OFFSETã‚’è¨ˆç®—ï¼ˆé‡è¦ï¼šãƒšãƒ¼ã‚¸1ã®å ´åˆã¯0ä»¶ã‚¹ã‚­ãƒƒãƒ—ï¼‰
$offset = ($current_page - 1) * $per_page;

// ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆãƒ—ãƒªãƒšã‚¢ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆï¼‰
$stmt = $pdo->prepare("SELECT * FROM articles ORDER BY created_at DESC LIMIT :limit OFFSET :offset");
$stmt->bindValue(':limit', $per_page, PDO::PARAM_INT);
$stmt->bindValue(':offset', $offset, PDO::PARAM_INT);
$stmt->execute();
$articles = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨˜äº‹ä¸€è¦§ - ãƒšãƒ¼ã‚¸ãƒ³ã‚°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .article {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .article h2 {
            margin-top: 0;
        }
        .article-meta {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>è¨˜äº‹ä¸€è¦§</h1>

    <p>ç¾åœ¨ã®ãƒšãƒ¼ã‚¸: <?php echo htmlspecialchars($current_page, ENT_QUOTES, 'UTF-8'); ?></p>

    <?php if (empty($articles)): ?>
        <p>è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
    <?php else: ?>
        <?php foreach ($articles as $article): ?>
            <div class="article">
                <h2><?php echo htmlspecialchars($article['title'], ENT_QUOTES, 'UTF-8'); ?></h2>
                <p><?php echo htmlspecialchars($article['content'], ENT_QUOTES, 'UTF-8'); ?></p>
                <div class="article-meta">
                    ã‚«ãƒ†ã‚´ãƒª: <?php echo htmlspecialchars($article['category'], ENT_QUOTES, 'UTF-8'); ?> |
                    æŠ•ç¨¿æ—¥: <?php echo htmlspecialchars($article['created_at'], ENT_QUOTES, 'UTF-8'); ?>
                </div>
            </div>
        <?php endforeach; ?>
    <?php endif; ?>
</body>
</html>
```

#### âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆ

1. **å‹ã‚­ãƒ£ã‚¹ãƒˆ**: `$current_page = (int)$current_page;` ã§ãƒšãƒ¼ã‚¸ç•ªå·ã‚’æ•´æ•°ã«å¤‰æ›
2. **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒšãƒ¼ã‚¸ç•ªå·ãŒ1æœªæº€ã®å ´åˆã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
3. **ãƒ—ãƒªãƒšã‚¢ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ**: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–
4. **bindValue() with PDO::PARAM_INT**: LIMIT/OFFSETã«ã¯å¿…ãšå‹æŒ‡å®š
5. **XSSå¯¾ç­–**: ã™ã¹ã¦ã®å‡ºåŠ›ã« `htmlspecialchars()` ã‚’ä½¿ç”¨
6. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ã‚’å®‰å…¨ã«è¡¨ç¤º

#### ğŸ’¡ ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆ

1. **OFFSETã®è¨ˆç®—**
```php
$offset = ($current_page - 1) * $per_page;
// ãƒšãƒ¼ã‚¸1: (1 - 1) * 10 = 0  â†’ 0ä»¶ã‚¹ã‚­ãƒƒãƒ—ï¼ˆ1ã€œ10ä»¶ç›®ï¼‰
// ãƒšãƒ¼ã‚¸2: (2 - 1) * 10 = 10 â†’ 10ä»¶ã‚¹ã‚­ãƒƒãƒ—ï¼ˆ11ã€œ20ä»¶ç›®ï¼‰
// ãƒšãƒ¼ã‚¸3: (3 - 1) * 10 = 20 â†’ 20ä»¶ã‚¹ã‚­ãƒƒãƒ—ï¼ˆ21ã€œ30ä»¶ç›®ï¼‰
```

2. **bindValue() vs bindParam()**
```php
// âœ… æ¨å¥¨: bindValue() - å€¤æ¸¡ã—
$stmt->bindValue(':limit', $per_page, PDO::PARAM_INT);

// âŒ é¿ã‘ã‚‹: bindParam() - å‚ç…§æ¸¡ã—ï¼ˆå¤‰æ•°ãŒå¤‰ã‚ã‚‹ã¨å•é¡Œï¼‰
$stmt->bindParam(':limit', $per_page, PDO::PARAM_INT);
```

3. **LIMIT/OFFSETã«å‹æŒ‡å®šãŒå¿…è¦**
```php
// PDO::PARAM_INT ã‚’æŒ‡å®šã—ãªã„ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å ´åˆãŒã‚ã‚‹
$stmt->bindValue(':limit', $per_page, PDO::PARAM_INT);
$stmt->bindValue(':offset', $offset, PDO::PARAM_INT);
```

#### ğŸ“ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

**ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã®ä»•çµ„ã¿**

ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã¯å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å°åˆ†ã‘ã«ã—ã¦è¡¨ç¤ºã™ã‚‹æŠ€è¡“ã§ã™ã€‚

```
å…¨100ä»¶ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆï¼ˆ1ãƒšãƒ¼ã‚¸10ä»¶ï¼‰:

ãƒšãƒ¼ã‚¸1: LIMIT 10 OFFSET 0  â†’ 1ã€œ10ä»¶ç›®
ãƒšãƒ¼ã‚¸2: LIMIT 10 OFFSET 10 â†’ 11ã€œ20ä»¶ç›®
ãƒšãƒ¼ã‚¸3: LIMIT 10 OFFSET 20 â†’ 21ã€œ30ä»¶ç›®
...
ãƒšãƒ¼ã‚¸10: LIMIT 10 OFFSET 90 â†’ 91ã€œ100ä»¶ç›®
```

**ã‚ˆãã‚ã‚‹é–“é•ã„**

```php
// âŒ é–“é•ã„: ãƒšãƒ¼ã‚¸1ã§10ä»¶ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã—ã¾ã†
$offset = $current_page * $per_page;

// âœ… æ­£è§£: ãƒšãƒ¼ã‚¸1ã§0ä»¶ã‚¹ã‚­ãƒƒãƒ—
$offset = ($current_page - 1) * $per_page;
```

---

### å•é¡Œ5-2ï¼šç·ãƒšãƒ¼ã‚¸æ•°ã®è¨ˆç®—

ç·ãƒšãƒ¼ã‚¸æ•°ã‚’è¨ˆç®—ã—ã¦ã€ã€Œå…¨â—‹ä»¶ / â—‹ãƒšãƒ¼ã‚¸ä¸­â—‹ãƒšãƒ¼ã‚¸ç›®ã€ã¨è¡¨ç¤ºã—ã¾ã™ã€‚

#### âœ… è§£ç­”ä¾‹

**pagination_with_count.php**

```php
<?php
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šï¼ˆçœç•¥ - å•é¡Œ5-1ã¨åŒã˜ï¼‰
require_once 'config.php';

// ãƒšãƒ¼ã‚¸ç•ªå·ã‚’å–å¾—
$current_page = $_GET['page'] ?? 1;
$current_page = (int)$current_page;

// ä¸æ­£ãªå€¤ã®ãƒã‚§ãƒƒã‚¯
if ($current_page < 1) {
    $current_page = 1;
}

// 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°
$per_page = 10;

// ç·ä»¶æ•°ã‚’å–å¾—
$stmt = $pdo->prepare("SELECT COUNT(*) FROM articles");
$stmt->execute();
$total_count = (int)$stmt->fetchColumn();

// ç·ãƒšãƒ¼ã‚¸æ•°ã‚’è¨ˆç®—
$total_pages = ceil($total_count / $per_page);

// ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ãŒç·ãƒšãƒ¼ã‚¸æ•°ã‚’è¶…ãˆã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
if ($current_page > $total_pages && $total_pages > 0) {
    // æœ€çµ‚ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    header("Location: ?page=$total_pages");
    exit;
}

// OFFSETã‚’è¨ˆç®—
$offset = ($current_page - 1) * $per_page;

// ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
$stmt = $pdo->prepare("SELECT * FROM articles ORDER BY created_at DESC LIMIT :limit OFFSET :offset");
$stmt->bindValue(':limit', $per_page, PDO::PARAM_INT);
$stmt->bindValue(':offset', $offset, PDO::PARAM_INT);
$stmt->execute();
$articles = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨˜äº‹ä¸€è¦§ - ãƒšãƒ¼ã‚¸ãƒ³ã‚°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .pagination-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .pagination-nav {
            margin-top: 20px;
            text-align: center;
        }
        .pagination-nav a,
        .pagination-nav span {
            display: inline-block;
            padding: 8px 12px;
            margin: 0 5px;
            text-decoration: none;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .pagination-nav a {
            background: #fff;
            color: #333;
        }
        .pagination-nav a:hover {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }
        .pagination-nav span.disabled {
            background: #f0f0f0;
            color: #999;
        }
        .article {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .article h2 {
            margin-top: 0;
        }
        .article-meta {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>è¨˜äº‹ä¸€è¦§</h1>

    <!-- ãƒšãƒ¼ã‚¸ãƒ³ã‚°æƒ…å ± -->
    <div class="pagination-info">
        å…¨<?php echo number_format($total_count); ?>ä»¶ /
        <?php echo number_format($total_pages); ?>ãƒšãƒ¼ã‚¸ä¸­
        <?php echo number_format($current_page); ?>ãƒšãƒ¼ã‚¸ç›®
    </div>

    <?php if (empty($articles)): ?>
        <p>è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
    <?php else: ?>
        <?php foreach ($articles as $article): ?>
            <div class="article">
                <h2><?php echo htmlspecialchars($article['title'], ENT_QUOTES, 'UTF-8'); ?></h2>
                <p><?php echo htmlspecialchars($article['content'], ENT_QUOTES, 'UTF-8'); ?></p>
                <div class="article-meta">
                    ã‚«ãƒ†ã‚´ãƒª: <?php echo htmlspecialchars($article['category'], ENT_QUOTES, 'UTF-8'); ?> |
                    æŠ•ç¨¿æ—¥: <?php echo htmlspecialchars($article['created_at'], ENT_QUOTES, 'UTF-8'); ?>
                </div>
            </div>
        <?php endforeach; ?>
    <?php endif; ?>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="pagination-nav">
        <!-- å‰ã¸ãƒœã‚¿ãƒ³ -->
        <?php if ($current_page > 1): ?>
            <a href="?page=<?php echo $current_page - 1; ?>">Â« å‰ã¸</a>
        <?php else: ?>
            <span class="disabled">Â« å‰ã¸</span>
        <?php endif; ?>

        <!-- æ¬¡ã¸ãƒœã‚¿ãƒ³ -->
        <?php if ($current_page < $total_pages): ?>
            <a href="?page=<?php echo $current_page + 1; ?>">æ¬¡ã¸ Â»</a>
        <?php else: ?>
            <span class="disabled">æ¬¡ã¸ Â»</span>
        <?php endif; ?>
    </div>
</body>
</html>
```

#### âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆ

1. **ç·ä»¶æ•°ã®å‹ã‚­ãƒ£ã‚¹ãƒˆ**: `(int)$stmt->fetchColumn()` ã§æ•´æ•°åŒ–
2. **ãƒšãƒ¼ã‚¸æ•°ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ç·ãƒšãƒ¼ã‚¸æ•°ã‚’è¶…ãˆã‚‹å ´åˆã¯æœ€çµ‚ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
3. **number_format()**: æ•°å€¤ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆXSSå¯¾ç­–ã¯ä¸è¦ã ãŒã€è¦‹ã‚„ã™ã•ã®ãŸã‚ä½¿ç”¨ï¼‰

#### ğŸ’¡ ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆ

1. **ç·ãƒšãƒ¼ã‚¸æ•°ã®è¨ˆç®—**
```php
$total_pages = ceil($total_count / $per_page);

// ä¾‹ï¼š
// 100ä»¶ Ã· 10ä»¶/ãƒšãƒ¼ã‚¸ = 10ãƒšãƒ¼ã‚¸
// 105ä»¶ Ã· 10ä»¶/ãƒšãƒ¼ã‚¸ = 10.5 â†’ ceil() ã§11ãƒšãƒ¼ã‚¸
// 95ä»¶ Ã· 10ä»¶/ãƒšãƒ¼ã‚¸ = 9.5 â†’ ceil() ã§10ãƒšãƒ¼ã‚¸
```

2. **ceil() é–¢æ•°ã®é‡è¦æ€§**
```php
// ceil() ã¯åˆ‡ã‚Šä¸Šã’é–¢æ•°
ceil(10.1) // 11
ceil(10.5) // 11
ceil(10.9) // 11
ceil(10.0) // 10

// âŒ floor() ã‚„ round() ã¯ä½¿ã‚ãªã„
floor(10.9) // 10 - æœ€å¾Œã®0.9ãƒšãƒ¼ã‚¸åˆ†ãŒè¡¨ç¤ºã•ã‚Œãªã„ï¼
round(10.4) // 10 - åŒæ§˜ã«è¡¨ç¤ºã•ã‚Œãªã„ãƒ‡ãƒ¼ã‚¿ãŒå‡ºã‚‹
```

3. **å‰ã¸ãƒ»æ¬¡ã¸ãƒœã‚¿ãƒ³ã®æ¡ä»¶åˆ†å²**
```php
// å‰ã¸ãƒœã‚¿ãƒ³: ãƒšãƒ¼ã‚¸1ã§ã¯ç„¡åŠ¹åŒ–
<?php if ($current_page > 1): ?>
    <a href="?page=<?php echo $current_page - 1; ?>">Â« å‰ã¸</a>
<?php else: ?>
    <span class="disabled">Â« å‰ã¸</span>
<?php endif; ?>

// æ¬¡ã¸ãƒœã‚¿ãƒ³: æœ€çµ‚ãƒšãƒ¼ã‚¸ã§ã¯ç„¡åŠ¹åŒ–
<?php if ($current_page < $total_pages): ?>
    <a href="?page=<?php echo $current_page + 1; ?>">æ¬¡ã¸ Â»</a>
<?php else: ?>
    <span class="disabled">æ¬¡ã¸ Â»</span>
<?php endif; ?>
```

#### ğŸ“ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

**ç·ãƒšãƒ¼ã‚¸æ•°ã®è¨ˆç®—ä¾‹**

```
100ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã€1ãƒšãƒ¼ã‚¸10ä»¶ã®å ´åˆ:
ç·ãƒšãƒ¼ã‚¸æ•° = ceil(100 / 10) = ceil(10) = 10ãƒšãƒ¼ã‚¸

105ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã€1ãƒšãƒ¼ã‚¸10ä»¶ã®å ´åˆ:
ç·ãƒšãƒ¼ã‚¸æ•° = ceil(105 / 10) = ceil(10.5) = 11ãƒšãƒ¼ã‚¸
ï¼ˆæœ€å¾Œã®ãƒšãƒ¼ã‚¸ã«ã¯5ä»¶ã ã‘è¡¨ç¤ºã•ã‚Œã‚‹ï¼‰

0ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã®å ´åˆ:
ç·ãƒšãƒ¼ã‚¸æ•° = ceil(0 / 10) = ceil(0) = 0ãƒšãƒ¼ã‚¸
ï¼ˆã“ã®å ´åˆã®å‡¦ç†ã«æ³¨æ„ï¼ï¼‰
```

**ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®å‡¦ç†**

```php
// ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã®å ´åˆ
if ($total_pages === 0) {
    // ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã‚’è¡¨ç¤ºã—ãªã„
    // ã¾ãŸã¯ã€Œãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€ã¨è¡¨ç¤º
}

// ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ãŒç·ãƒšãƒ¼ã‚¸æ•°ã‚’è¶…ãˆã¦ã„ã‚‹å ´åˆ
if ($current_page > $total_pages && $total_pages > 0) {
    // æœ€çµ‚ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    header("Location: ?page=$total_pages");
    exit;
}
```

---

### å•é¡Œ5-3ï¼šãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã®è¡¨ç¤º

ã€Œå‰ã¸ã€ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã¨ã€ãƒšãƒ¼ã‚¸ç•ªå·ã®ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

#### âœ… è§£ç­”ä¾‹

**pagination_with_links.php**

```php
<?php
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šï¼ˆçœç•¥ - å•é¡Œ5-1ã¨åŒã˜ï¼‰
require_once 'config.php';

// ãƒšãƒ¼ã‚¸ç•ªå·ã‚’å–å¾—
$current_page = $_GET['page'] ?? 1;
$current_page = (int)$current_page;

if ($current_page < 1) {
    $current_page = 1;
}

$per_page = 10;

// ç·ä»¶æ•°ã‚’å–å¾—
$stmt = $pdo->prepare("SELECT COUNT(*) FROM articles");
$stmt->execute();
$total_count = (int)$stmt->fetchColumn();

// ç·ãƒšãƒ¼ã‚¸æ•°ã‚’è¨ˆç®—
$total_pages = ceil($total_count / $per_page);

if ($current_page > $total_pages && $total_pages > 0) {
    header("Location: ?page=$total_pages");
    exit;
}

// OFFSETã‚’è¨ˆç®—
$offset = ($current_page - 1) * $per_page;

// ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
$stmt = $pdo->prepare("SELECT * FROM articles ORDER BY created_at DESC LIMIT :limit OFFSET :offset");
$stmt->bindValue(':limit', $per_page, PDO::PARAM_INT);
$stmt->bindValue(':offset', $offset, PDO::PARAM_INT);
$stmt->execute();
$articles = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨˜äº‹ä¸€è¦§ - ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .pagination-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .pagination a,
        .pagination span,
        .pagination strong {
            display: inline-block;
            padding: 8px 12px;
            text-decoration: none;
            border: 1px solid #ddd;
            border-radius: 3px;
            min-width: 40px;
            text-align: center;
        }
        .pagination a {
            background: #fff;
            color: #333;
        }
        .pagination a:hover {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }
        .pagination strong {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }
        .pagination span.disabled {
            background: #f0f0f0;
            color: #999;
        }
        .article {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .article h2 {
            margin-top: 0;
            color: #333;
        }
        .article-meta {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>è¨˜äº‹ä¸€è¦§</h1>

    <div class="pagination-info">
        å…¨<?php echo number_format($total_count); ?>ä»¶ /
        <?php echo number_format($total_pages); ?>ãƒšãƒ¼ã‚¸ä¸­
        <?php echo number_format($current_page); ?>ãƒšãƒ¼ã‚¸ç›®
    </div>

    <?php if (empty($articles)): ?>
        <p>è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
    <?php else: ?>
        <?php foreach ($articles as $article): ?>
            <div class="article">
                <h2><?php echo htmlspecialchars($article['title'], ENT_QUOTES, 'UTF-8'); ?></h2>
                <p><?php echo htmlspecialchars($article['content'], ENT_QUOTES, 'UTF-8'); ?></p>
                <div class="article-meta">
                    ã‚«ãƒ†ã‚´ãƒª: <?php echo htmlspecialchars($article['category'], ENT_QUOTES, 'UTF-8'); ?> |
                    æŠ•ç¨¿æ—¥: <?php echo htmlspecialchars($article['created_at'], ENT_QUOTES, 'UTF-8'); ?>
                </div>
            </div>
        <?php endforeach; ?>
    <?php endif; ?>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="pagination">
        <!-- å‰ã¸ãƒœã‚¿ãƒ³ -->
        <?php if ($current_page > 1): ?>
            <a href="?page=<?php echo $current_page - 1; ?>">Â« å‰ã¸</a>
        <?php else: ?>
            <span class="disabled">Â« å‰ã¸</span>
        <?php endif; ?>

        <!-- ãƒšãƒ¼ã‚¸ç•ªå·ãƒªãƒ³ã‚¯ -->
        <?php for ($i = 1; $i <= $total_pages; $i++): ?>
            <?php if ($i === $current_page): ?>
                <strong><?php echo $i; ?></strong>
            <?php else: ?>
                <a href="?page=<?php echo $i; ?>"><?php echo $i; ?></a>
            <?php endif; ?>
        <?php endfor; ?>

        <!-- æ¬¡ã¸ãƒœã‚¿ãƒ³ -->
        <?php if ($current_page < $total_pages): ?>
            <a href="?page=<?php echo $current_page + 1; ?>">æ¬¡ã¸ Â»</a>
        <?php else: ?>
            <span class="disabled">æ¬¡ã¸ Â»</span>
        <?php endif; ?>
    </div>
</body>
</html>
```

#### âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆ

1. **ãƒšãƒ¼ã‚¸ç•ªå·ã®å‡ºåŠ›**: `<?php echo $i; ?>` ã¯æ•°å€¤ãªã®ã§XSS ã®å¿ƒé…ã¯ãªã„ãŒã€å¿µã®ãŸã‚æ¤œè¨¼æ¸ˆã¿
2. **XSSå¯¾ç­–**: ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ï¼ˆè¨˜äº‹ãƒ‡ãƒ¼ã‚¿ï¼‰ã« `htmlspecialchars()` ã‚’ä½¿ç”¨
3. **ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®è­˜åˆ¥**: `===` ã§å³å¯†ãªæ¯”è¼ƒã‚’ä½¿ç”¨

#### ğŸ’¡ ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆ

1. **ãƒšãƒ¼ã‚¸ç•ªå·ãƒªãƒ³ã‚¯ã®ç”Ÿæˆ**
```php
<?php for ($i = 1; $i <= $total_pages; $i++): ?>
    <?php if ($i === $current_page): ?>
        <!-- ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã¯å¼·èª¿è¡¨ç¤ºï¼ˆãƒªãƒ³ã‚¯ãªã—ï¼‰ -->
        <strong><?php echo $i; ?></strong>
    <?php else: ?>
        <!-- ä»–ã®ãƒšãƒ¼ã‚¸ã¯ãƒªãƒ³ã‚¯ -->
        <a href="?page=<?php echo $i; ?>"><?php echo $i; ?></a>
    <?php endif; ?>
<?php endfor; ?>
```

2. **Flexboxã§ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**
```css
.pagination {
    display: flex;
    justify-content: center;  /* ä¸­å¤®æƒãˆ */
    align-items: center;       /* å‚ç›´æ–¹å‘ã®ä¸­å¤®æƒãˆ */
    gap: 5px;                  /* è¦ç´ é–“ã®é–“éš” */
    flex-wrap: wrap;           /* ãƒšãƒ¼ã‚¸æ•°ãŒå¤šã„å ´åˆã¯æŠ˜ã‚Šè¿”ã— */
}
```

#### ğŸ“ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

**ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®UI/UXãƒ‡ã‚¶ã‚¤ãƒ³**

è‰¯ã„ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®æ¡ä»¶ï¼š
1. **ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ãŒæ˜ç¢º**: å¼·èª¿è¡¨ç¤ºã‚„ã‚¹ã‚¿ã‚¤ãƒ«ã§åŒºåˆ¥
2. **å‰ã¸ãƒ»æ¬¡ã¸ãŒåˆ†ã‹ã‚Šã‚„ã™ã„**: è¨˜å·ï¼ˆÂ«, Â»ï¼‰ã§è¦–è¦šçš„ã«è¡¨ç¾
3. **ç„¡åŠ¹ãªæ“ä½œã‚’é˜²ã**: æœ€åˆ/æœ€å¾Œã®ãƒšãƒ¼ã‚¸ã§ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
4. **ã‚¯ãƒªãƒƒã‚¯ã—ã‚„ã™ã„**: ååˆ†ãªå¤§ãã•ã¨ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°
5. **ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ**: flex-wrap ã§æŠ˜ã‚Šè¿”ã—å¯¾å¿œ

**ã‚ˆãã‚ã‚‹æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ**

```php
// âŒ æ‚ªã„ä¾‹: ãƒšãƒ¼ã‚¸æ•°ãŒ100ãƒšãƒ¼ã‚¸ã‚ã‚‹ã¨100å€‹ã®ãƒªãƒ³ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã‚‹
<?php for ($i = 1; $i <= $total_pages; $i++): ?>
    <a href="?page=<?php echo $i; ?>"><?php echo $i; ?></a>
<?php endfor; ?>

// âœ… è‰¯ã„ä¾‹: ãƒšãƒ¼ã‚¸æ•°ãŒå¤šã„å ´åˆã¯çœç•¥è¡¨ç¤ºï¼ˆå•é¡Œ5-4ã§å®Ÿè£…ï¼‰
// ä¾‹: 1 ... 8 9 10 11 12 ... 100
```

---

## å¿œç”¨ç·¨

### å•é¡Œ5-4ï¼šçœç•¥è¡¨ç¤ºï¼ˆ...ï¼‰ã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³

ãƒšãƒ¼ã‚¸æ•°ãŒå¤šã„å ´åˆã«ã€çœç•¥è¡¨ç¤ºï¼ˆ...ï¼‰ã‚’ä½¿ã£ãŸãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

#### âœ… è§£ç­”ä¾‹

**pagination_ellipsis.php**

```php
<?php
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
require_once 'config.php';

// ãƒšãƒ¼ã‚¸ç•ªå·ã‚’å–å¾—
$current_page = $_GET['page'] ?? 1;
$current_page = (int)$current_page;

if ($current_page < 1) {
    $current_page = 1;
}

$per_page = 10;

// ç·ä»¶æ•°ã‚’å–å¾—
$stmt = $pdo->prepare("SELECT COUNT(*) FROM articles");
$stmt->execute();
$total_count = (int)$stmt->fetchColumn();

// ç·ãƒšãƒ¼ã‚¸æ•°ã‚’è¨ˆç®—
$total_pages = ceil($total_count / $per_page);

if ($current_page > $total_pages && $total_pages > 0) {
    header("Location: ?page=$total_pages");
    exit;
}

// OFFSETã‚’è¨ˆç®—
$offset = ($current_page - 1) * $per_page;

// ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
$stmt = $pdo->prepare("SELECT * FROM articles ORDER BY created_at DESC LIMIT :limit OFFSET :offset");
$stmt->bindValue(':limit', $per_page, PDO::PARAM_INT);
$stmt->bindValue(':offset', $offset, PDO::PARAM_INT);
$stmt->execute();
$articles = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨˜äº‹ä¸€è¦§ - çœç•¥è¡¨ç¤ºãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .pagination-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .pagination a,
        .pagination span,
        .pagination strong {
            display: inline-block;
            padding: 8px 12px;
            text-decoration: none;
            border: 1px solid #ddd;
            border-radius: 3px;
            min-width: 40px;
            text-align: center;
        }
        .pagination a {
            background: #fff;
            color: #333;
        }
        .pagination a:hover {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }
        .pagination strong {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }
        .pagination span.disabled {
            background: #f0f0f0;
            color: #999;
        }
        .pagination span.ellipsis {
            border: none;
            background: transparent;
        }
        .article {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .article h2 {
            margin-top: 0;
        }
        .article-meta {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>è¨˜äº‹ä¸€è¦§</h1>

    <div class="pagination-info">
        å…¨<?php echo number_format($total_count); ?>ä»¶ /
        <?php echo number_format($total_pages); ?>ãƒšãƒ¼ã‚¸ä¸­
        <?php echo number_format($current_page); ?>ãƒšãƒ¼ã‚¸ç›®
    </div>

    <?php if (empty($articles)): ?>
        <p>è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
    <?php else: ?>
        <?php foreach ($articles as $article): ?>
            <div class="article">
                <h2><?php echo htmlspecialchars($article['title'], ENT_QUOTES, 'UTF-8'); ?></h2>
                <p><?php echo htmlspecialchars($article['content'], ENT_QUOTES, 'UTF-8'); ?></p>
                <div class="article-meta">
                    ã‚«ãƒ†ã‚´ãƒª: <?php echo htmlspecialchars($article['category'], ENT_QUOTES, 'UTF-8'); ?> |
                    æŠ•ç¨¿æ—¥: <?php echo htmlspecialchars($article['created_at'], ENT_QUOTES, 'UTF-8'); ?>
                </div>
            </div>
        <?php endforeach; ?>
    <?php endif; ?>

    <!-- çœç•¥è¡¨ç¤ºãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="pagination">
        <!-- å‰ã¸ãƒœã‚¿ãƒ³ -->
        <?php if ($current_page > 1): ?>
            <a href="?page=<?php echo $current_page - 1; ?>">Â« å‰ã¸</a>
        <?php else: ?>
            <span class="disabled">Â« å‰ã¸</span>
        <?php endif; ?>

        <?php
        // è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ç•ªå·ã®ç¯„å›²ã‚’è¨ˆç®—
        $range = 2; // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®å‰å¾Œä½•ãƒšãƒ¼ã‚¸è¡¨ç¤ºã™ã‚‹ã‹
        $start = max(1, $current_page - $range);
        $end = min($total_pages, $current_page + $range);

        // æœ€åˆã®ãƒšãƒ¼ã‚¸
        if ($start > 1) {
            echo '<a href="?page=1">1</a>';
            if ($start > 2) {
                echo '<span class="ellipsis">...</span>';
            }
        }

        // ç¯„å›²å†…ã®ãƒšãƒ¼ã‚¸
        for ($i = $start; $i <= $end; $i++) {
            if ($i === $current_page) {
                echo "<strong>{$i}</strong>";
            } else {
                echo "<a href='?page={$i}'>{$i}</a>";
            }
        }

        // æœ€å¾Œã®ãƒšãƒ¼ã‚¸
        if ($end < $total_pages) {
            if ($end < $total_pages - 1) {
                echo '<span class="ellipsis">...</span>';
            }
            echo "<a href='?page={$total_pages}'>{$total_pages}</a>";
        }
        ?>

        <!-- æ¬¡ã¸ãƒœã‚¿ãƒ³ -->
        <?php if ($current_page < $total_pages): ?>
            <a href="?page=<?php echo $current_page + 1; ?>">æ¬¡ã¸ Â»</a>
        <?php else: ?>
            <span class="disabled">æ¬¡ã¸ Â»</span>
        <?php endif; ?>
    </div>
</body>
</html>
```

#### âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆ

1. **æ•°å€¤ã®å‡ºåŠ›**: `$i` ã‚„ `$total_pages` ã¯è¨ˆç®—æ¸ˆã¿ã®æ•´æ•°ãªã®ã§å®‰å…¨
2. **ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ç”±æ¥ã®ãƒ‡ãƒ¼ã‚¿ã¯ `htmlspecialchars()` ã§å‡¦ç†

#### ğŸ’¡ ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆ

1. **çœç•¥è¡¨ç¤ºã®ãƒ­ã‚¸ãƒƒã‚¯**
```php
$range = 2; // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®å‰å¾Œ2ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
$start = max(1, $current_page - $range);
$end = min($total_pages, $current_page + $range);

// ä¾‹: ç¾åœ¨10ãƒšãƒ¼ã‚¸ç›®ã€ç·20ãƒšãƒ¼ã‚¸ã®å ´åˆ
// $start = max(1, 10 - 2) = 8
// $end = min(20, 10 + 2) = 12
// çµæœ: 8 9 10 11 12 ãŒè¡¨ç¤ºã•ã‚Œã‚‹
```

2. **çœç•¥è¨˜å·ï¼ˆ...ï¼‰ã®è¡¨ç¤ºæ¡ä»¶**
```php
// æœ€åˆã®ãƒšãƒ¼ã‚¸ã¨ã®é–“ã«éš™é–“ãŒã‚ã‚‹å ´åˆ
if ($start > 1) {
    echo '<a href="?page=1">1</a>';
    if ($start > 2) {
        // ãƒšãƒ¼ã‚¸1ã¨è¡¨ç¤ºç¯„å›²ã®é–“ã«2ãƒšãƒ¼ã‚¸ä»¥ä¸Šã®éš™é–“ãŒã‚ã‚‹
        echo '<span class="ellipsis">...</span>';
    }
}
```

3. **è¡¨ç¤ºãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¾‹**
```
ãƒšãƒ¼ã‚¸1ã®å ´åˆï¼ˆrange=2ï¼‰:
1 2 3 ... 20

ãƒšãƒ¼ã‚¸2ã®å ´åˆ:
1 2 3 4 ... 20

ãƒšãƒ¼ã‚¸10ã®å ´åˆ:
1 ... 8 9 10 11 12 ... 20

ãƒšãƒ¼ã‚¸19ã®å ´åˆ:
1 ... 17 18 19 20

ãƒšãƒ¼ã‚¸20ã®å ´åˆ:
1 ... 18 19 20
```

#### ğŸ“ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

**max() ã¨ min() é–¢æ•°ã®æ´»ç”¨**

```php
// ç¯„å›²ãŒé…åˆ—ã®å¤–ã«å‡ºãªã„ã‚ˆã†ã«åˆ¶é™
$start = max(1, $current_page - $range);
// ä¾‹:
// ãƒšãƒ¼ã‚¸1ã®å ´åˆ: max(1, 1 - 2) = max(1, -1) = 1
// ãƒšãƒ¼ã‚¸5ã®å ´åˆ: max(1, 5 - 2) = max(1, 3) = 3

$end = min($total_pages, $current_page + $range);
// ä¾‹: ç·20ãƒšãƒ¼ã‚¸ã®å ´åˆ
// ãƒšãƒ¼ã‚¸19ã®å ´åˆ: min(20, 19 + 2) = min(20, 21) = 20
// ãƒšãƒ¼ã‚¸10ã®å ´åˆ: min(20, 10 + 2) = min(20, 12) = 12
```

**rangeã®å€¤ã«ã‚ˆã‚‹è¡¨ç¤ºã®é•ã„**

```php
// range = 1 ã®å ´åˆï¼ˆç‹­ã„ï¼‰
1 ... 9 10 11 ... 100

// range = 2 ã®å ´åˆï¼ˆæ¨™æº–ï¼‰
1 ... 8 9 10 11 12 ... 100

// range = 3 ã®å ´åˆï¼ˆåºƒã„ï¼‰
1 ... 7 8 9 10 11 12 13 ... 100
```

**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿**

```php
// âŒ æ‚ªã„ä¾‹: 10,000ãƒšãƒ¼ã‚¸å…¨éƒ¨ã®ãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆ
for ($i = 1; $i <= 10000; $i++) {
    echo "<a href='?page={$i}'>{$i}</a>";
}
// â†’ HTMLãŒå·¨å¤§ã«ãªã‚Šã€ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ãŒé…ã„

// âœ… è‰¯ã„ä¾‹: å¿…è¦ãªéƒ¨åˆ†ã ã‘ç”Ÿæˆï¼ˆçœç•¥è¡¨ç¤ºï¼‰
// â†’ å¸¸ã«10å€‹å‰å¾Œã®ãƒªãƒ³ã‚¯ã ã‘ãªã®ã§é«˜é€Ÿ
```

---

### å•é¡Œ5-5ï¼š1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°ã‚’å¤‰æ›´å¯èƒ½ã«ã™ã‚‹

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®è¡¨ç¤ºä»¶æ•°ã‚’é¸æŠã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

#### âœ… è§£ç­”ä¾‹

**pagination_configurable.php**

```php
<?php
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
require_once 'config.php';

// è¨±å¯ã™ã‚‹è¡¨ç¤ºä»¶æ•°ã®é…åˆ—ï¼ˆãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆï¼‰
$allowed_per_page = [10, 25, 50, 100];

// 1ãƒšãƒ¼ã‚¸ã‚ãŸã‚Šã®ä»¶æ•°ã‚’å–å¾—
$per_page = $_GET['per_page'] ?? 10;
$per_page = (int)$per_page;

// ä¸æ­£ãªå€¤ã®ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ï¼‰
if (!in_array($per_page, $allowed_per_page, true)) {
    $per_page = 10; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
}

// ãƒšãƒ¼ã‚¸ç•ªå·ã‚’å–å¾—
$current_page = $_GET['page'] ?? 1;
$current_page = (int)$current_page;

if ($current_page < 1) {
    $current_page = 1;
}

// ç·ä»¶æ•°ã‚’å–å¾—
$stmt = $pdo->prepare("SELECT COUNT(*) FROM articles");
$stmt->execute();
$total_count = (int)$stmt->fetchColumn();

// ç·ãƒšãƒ¼ã‚¸æ•°ã‚’è¨ˆç®—
$total_pages = ceil($total_count / $per_page);

if ($current_page > $total_pages && $total_pages > 0) {
    header("Location: ?page=$total_pages&per_page=$per_page");
    exit;
}

// OFFSETã‚’è¨ˆç®—
$offset = ($current_page - 1) * $per_page;

// ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
$stmt = $pdo->prepare("SELECT * FROM articles ORDER BY created_at DESC LIMIT :limit OFFSET :offset");
$stmt->bindValue(':limit', $per_page, PDO::PARAM_INT);
$stmt->bindValue(':offset', $offset, PDO::PARAM_INT);
$stmt->execute();
$articles = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨˜äº‹ä¸€è¦§ - è¡¨ç¤ºä»¶æ•°å¤‰æ›´å¯èƒ½</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .per-page-selector select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
        }
        .pagination-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .pagination a,
        .pagination span,
        .pagination strong {
            display: inline-block;
            padding: 8px 12px;
            text-decoration: none;
            border: 1px solid #ddd;
            border-radius: 3px;
            min-width: 40px;
            text-align: center;
        }
        .pagination a {
            background: #fff;
            color: #333;
        }
        .pagination a:hover {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }
        .pagination strong {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }
        .pagination span.disabled {
            background: #f0f0f0;
            color: #999;
        }
        .pagination span.ellipsis {
            border: none;
            background: transparent;
        }
        .article {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .article h2 {
            margin-top: 0;
        }
        .article-meta {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>è¨˜äº‹ä¸€è¦§</h1>

    <!-- è¡¨ç¤ºä»¶æ•°é¸æŠ -->
    <div class="controls">
        <div class="per-page-selector">
            <label for="per_page">è¡¨ç¤ºä»¶æ•°: </label>
            <select id="per_page" name="per_page" onchange="location.href='?page=1&per_page=' + this.value;">
                <?php foreach ($allowed_per_page as $option): ?>
                    <option value="<?php echo $option; ?>" <?php echo ($option === $per_page) ? 'selected' : ''; ?>>
                        <?php echo $option; ?>ä»¶è¡¨ç¤º
                    </option>
                <?php endforeach; ?>
            </select>
        </div>

        <div class="pagination-info">
            å…¨<?php echo number_format($total_count); ?>ä»¶ /
            <?php echo number_format($total_pages); ?>ãƒšãƒ¼ã‚¸ä¸­
            <?php echo number_format($current_page); ?>ãƒšãƒ¼ã‚¸ç›®
        </div>
    </div>

    <?php if (empty($articles)): ?>
        <p>è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
    <?php else: ?>
        <?php foreach ($articles as $article): ?>
            <div class="article">
                <h2><?php echo htmlspecialchars($article['title'], ENT_QUOTES, 'UTF-8'); ?></h2>
                <p><?php echo htmlspecialchars($article['content'], ENT_QUOTES, 'UTF-8'); ?></p>
                <div class="article-meta">
                    ã‚«ãƒ†ã‚´ãƒª: <?php echo htmlspecialchars($article['category'], ENT_QUOTES, 'UTF-8'); ?> |
                    æŠ•ç¨¿æ—¥: <?php echo htmlspecialchars($article['created_at'], ENT_QUOTES, 'UTF-8'); ?>
                </div>
            </div>
        <?php endforeach; ?>
    <?php endif; ?>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="pagination">
        <!-- å‰ã¸ãƒœã‚¿ãƒ³ -->
        <?php if ($current_page > 1): ?>
            <a href="?page=<?php echo $current_page - 1; ?>&per_page=<?php echo $per_page; ?>">Â« å‰ã¸</a>
        <?php else: ?>
            <span class="disabled">Â« å‰ã¸</span>
        <?php endif; ?>

        <?php
        // çœç•¥è¡¨ç¤ºã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
        $range = 2;
        $start = max(1, $current_page - $range);
        $end = min($total_pages, $current_page + $range);

        if ($start > 1) {
            echo '<a href="?page=1&per_page=' . $per_page . '">1</a>';
            if ($start > 2) {
                echo '<span class="ellipsis">...</span>';
            }
        }

        for ($i = $start; $i <= $end; $i++) {
            if ($i === $current_page) {
                echo "<strong>{$i}</strong>";
            } else {
                echo "<a href='?page={$i}&per_page={$per_page}'>{$i}</a>";
            }
        }

        if ($end < $total_pages) {
            if ($end < $total_pages - 1) {
                echo '<span class="ellipsis">...</span>';
            }
            echo "<a href='?page={$total_pages}&per_page={$per_page}'>{$total_pages}</a>";
        }
        ?>

        <!-- æ¬¡ã¸ãƒœã‚¿ãƒ³ -->
        <?php if ($current_page < $total_pages): ?>
            <a href="?page=<?php echo $current_page + 1; ?>&per_page=<?php echo $per_page; ?>">æ¬¡ã¸ Â»</a>
        <?php else: ?>
            <span class="disabled">æ¬¡ã¸ Â»</span>
        <?php endif; ?>
    </div>
</body>
</html>
```

#### âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆ

1. **ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼**: `$allowed_per_page` ã§è¨±å¯ã™ã‚‹å€¤ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
2. **in_array() ã®å³å¯†æ¯”è¼ƒ**: ç¬¬3å¼•æ•°ã« `true` ã‚’æŒ‡å®šã—ã¦å‹ã‚‚æ¯”è¼ƒ
3. **ã™ã¹ã¦ã®ãƒªãƒ³ã‚¯ã«per_pageã‚’å«ã‚ã‚‹**: URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¿æŒ

#### ğŸ’¡ ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆ

1. **ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**
```php
// è¨±å¯ã™ã‚‹å€¤ã‚’é…åˆ—ã§å®šç¾©
$allowed_per_page = [10, 25, 50, 100];

// ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ãƒã‚§ãƒƒã‚¯
if (!in_array($per_page, $allowed_per_page, true)) {
    $per_page = 10; // ä¸æ­£ãªå€¤ãªã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
}
```

2. **ã™ã¹ã¦ã®ãƒªãƒ³ã‚¯ã«per_pageãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ **
```php
// ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯
<a href="?page=<?php echo $i; ?>&per_page=<?php echo $per_page; ?>">

// æ¬¡ã¸ãƒœã‚¿ãƒ³
<a href="?page=<?php echo $current_page + 1; ?>&per_page=<?php echo $per_page; ?>">

// è¡¨ç¤ºä»¶æ•°å¤‰æ›´æ™‚ã¯ãƒšãƒ¼ã‚¸1ã«æˆ»ã‚‹
<select onchange="location.href='?page=1&per_page=' + this.value;">
```

3. **selectã‚¿ã‚°ã§ã®é¸æŠçŠ¶æ…‹ã®ç¶­æŒ**
```php
<option value="<?php echo $option; ?>" <?php echo ($option === $per_page) ? 'selected' : ''; ?>>
    <?php echo $option; ?>ä»¶è¡¨ç¤º
</option>
```

#### ğŸ“ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

**ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ vs ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆ**

```php
// âœ… ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ï¼ˆæ¨å¥¨ï¼‰- è¨±å¯ã™ã‚‹å€¤ã‚’æ˜ç¤º
$allowed_per_page = [10, 25, 50, 100];
if (!in_array($per_page, $allowed_per_page, true)) {
    $per_page = 10;
}

// âŒ ç¯„å›²ãƒã‚§ãƒƒã‚¯æ–¹å¼ï¼ˆå±é™ºï¼‰- äºˆæœŸã—ãªã„å€¤ã‚’è¨±å¯ã—ã¦ã—ã¾ã†
if ($per_page < 1 || $per_page > 1000) {
    $per_page = 10;
}
// â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ999ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è² è·ãŒã‹ã‹ã‚‹
```

**URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä¿æŒ**

ãƒšãƒ¼ã‚¸ãƒ³ã‚°æ©Ÿèƒ½ã§ã¯ã€URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é©åˆ‡ã«ä¿æŒã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

```php
// æ‚ªã„ä¾‹ï¼šper_pageãŒå¤±ã‚ã‚Œã‚‹
<a href="?page=2">æ¬¡ã¸</a>
// â†’ ãƒšãƒ¼ã‚¸2ã«ç§»å‹•ã™ã‚‹ã¨ã€per_pageãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã£ã¦ã—ã¾ã†

// è‰¯ã„ä¾‹ï¼šã™ã¹ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¿æŒ
<a href="?page=2&per_page=<?php echo $per_page; ?>">æ¬¡ã¸</a>
// â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠã—ãŸè¡¨ç¤ºä»¶æ•°ãŒç¶­æŒã•ã‚Œã‚‹
```

---

### å•é¡Œ5-6ï¼šæ¤œç´¢çµæœã®ãƒšãƒ¼ã‚¸ãƒ³ã‚°

æ¤œç´¢æ©Ÿèƒ½ã¨ãƒšãƒ¼ã‚¸ãƒ³ã‚°å‡¦ç†ã‚’çµ„ã¿åˆã‚ã›ã¾ã™ã€‚

#### âœ… è§£ç­”ä¾‹

**pagination_search.php**

```php
<?php
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
require_once 'config.php';

// æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—
$keyword = $_GET['keyword'] ?? '';
$keyword = trim($keyword); // å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤

// ãƒšãƒ¼ã‚¸ç•ªå·ã‚’å–å¾—
$current_page = $_GET['page'] ?? 1;
$current_page = (int)$current_page;

if ($current_page < 1) {
    $current_page = 1;
}

$per_page = 10;

// SQLã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰
if (!empty($keyword)) {
    // æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒã‚ã‚‹å ´åˆ
    $sql = "SELECT * FROM articles WHERE title LIKE :keyword OR content LIKE :keyword ORDER BY created_at DESC LIMIT :limit OFFSET :offset";
    $count_sql = "SELECT COUNT(*) FROM articles WHERE title LIKE :keyword OR content LIKE :keyword";

    // LIKEæ¤œç´¢ç”¨ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆéƒ¨åˆ†ä¸€è‡´ï¼‰
    $search_pattern = '%' . $keyword . '%';
} else {
    // æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒãªã„å ´åˆï¼ˆå…¨ä»¶è¡¨ç¤ºï¼‰
    $sql = "SELECT * FROM articles ORDER BY created_at DESC LIMIT :limit OFFSET :offset";
    $count_sql = "SELECT COUNT(*) FROM articles";
}

// ç·ä»¶æ•°ã‚’å–å¾—
$count_stmt = $pdo->prepare($count_sql);
if (!empty($keyword)) {
    $count_stmt->bindValue(':keyword', $search_pattern, PDO::PARAM_STR);
}
$count_stmt->execute();
$total_count = (int)$count_stmt->fetchColumn();

// ç·ãƒšãƒ¼ã‚¸æ•°ã‚’è¨ˆç®—
$total_pages = ceil($total_count / $per_page);

if ($current_page > $total_pages && $total_pages > 0) {
    $redirect_url = "?page=$total_pages";
    if (!empty($keyword)) {
        $redirect_url .= "&keyword=" . urlencode($keyword);
    }
    header("Location: $redirect_url");
    exit;
}

// OFFSETã‚’è¨ˆç®—
$offset = ($current_page - 1) * $per_page;

// ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
$stmt = $pdo->prepare($sql);
if (!empty($keyword)) {
    $stmt->bindValue(':keyword', $search_pattern, PDO::PARAM_STR);
}
$stmt->bindValue(':limit', $per_page, PDO::PARAM_INT);
$stmt->bindValue(':offset', $offset, PDO::PARAM_INT);
$stmt->execute();
$articles = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨˜äº‹æ¤œç´¢ - ãƒšãƒ¼ã‚¸ãƒ³ã‚°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .search-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .search-form input[type="text"] {
            width: 70%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
        }
        .search-form button {
            padding: 10px 20px;
            background: #007bff;
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }
        .search-form button:hover {
            background: #0056b3;
        }
        .search-info {
            background: #e7f3ff;
            padding: 10px 15px;
            border-left: 4px solid #007bff;
            margin-bottom: 20px;
        }
        .pagination-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .pagination a,
        .pagination span,
        .pagination strong {
            display: inline-block;
            padding: 8px 12px;
            text-decoration: none;
            border: 1px solid #ddd;
            border-radius: 3px;
            min-width: 40px;
            text-align: center;
        }
        .pagination a {
            background: #fff;
            color: #333;
        }
        .pagination a:hover {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }
        .pagination strong {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }
        .pagination span.disabled {
            background: #f0f0f0;
            color: #999;
        }
        .pagination span.ellipsis {
            border: none;
            background: transparent;
        }
        .article {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .article h2 {
            margin-top: 0;
        }
        .article-meta {
            color: #666;
            font-size: 0.9em;
        }
        .no-results {
            text-align: center;
            padding: 40px 20px;
            background: #f8f9fa;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>è¨˜äº‹æ¤œç´¢</h1>

    <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="search-form">
        <form method="GET" action="">
            <input type="text" name="keyword" value="<?php echo htmlspecialchars($keyword, ENT_QUOTES, 'UTF-8'); ?>" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›...">
            <button type="submit">æ¤œç´¢</button>
        </form>
    </div>

    <?php if (!empty($keyword)): ?>
        <div class="search-info">
            ã€Œ<?php echo htmlspecialchars($keyword, ENT_QUOTES, 'UTF-8'); ?>ã€ã®æ¤œç´¢çµæœ: <?php echo number_format($total_count); ?>ä»¶
        </div>
    <?php endif; ?>

    <div class="pagination-info">
        å…¨<?php echo number_format($total_count); ?>ä»¶ /
        <?php echo number_format($total_pages); ?>ãƒšãƒ¼ã‚¸ä¸­
        <?php echo number_format($current_page); ?>ãƒšãƒ¼ã‚¸ç›®
    </div>

    <?php if (empty($articles)): ?>
        <div class="no-results">
            <p>è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
            <?php if (!empty($keyword)): ?>
                <p><a href="?">ã™ã¹ã¦ã®è¨˜äº‹ã‚’è¡¨ç¤º</a></p>
            <?php endif; ?>
        </div>
    <?php else: ?>
        <?php foreach ($articles as $article): ?>
            <div class="article">
                <h2><?php echo htmlspecialchars($article['title'], ENT_QUOTES, 'UTF-8'); ?></h2>
                <p><?php echo htmlspecialchars($article['content'], ENT_QUOTES, 'UTF-8'); ?></p>
                <div class="article-meta">
                    ã‚«ãƒ†ã‚´ãƒª: <?php echo htmlspecialchars($article['category'], ENT_QUOTES, 'UTF-8'); ?> |
                    æŠ•ç¨¿æ—¥: <?php echo htmlspecialchars($article['created_at'], ENT_QUOTES, 'UTF-8'); ?>
                </div>
            </div>
        <?php endforeach; ?>
    <?php endif; ?>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <?php if ($total_pages > 0): ?>
        <div class="pagination">
            <!-- å‰ã¸ãƒœã‚¿ãƒ³ -->
            <?php if ($current_page > 1): ?>
                <a href="?page=<?php echo $current_page - 1; ?>&keyword=<?php echo urlencode($keyword); ?>">Â« å‰ã¸</a>
            <?php else: ?>
                <span class="disabled">Â« å‰ã¸</span>
            <?php endif; ?>

            <?php
            // çœç•¥è¡¨ç¤ºã®ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
            $range = 2;
            $start = max(1, $current_page - $range);
            $end = min($total_pages, $current_page + $range);

            if ($start > 1) {
                echo '<a href="?page=1&keyword=' . urlencode($keyword) . '">1</a>';
                if ($start > 2) {
                    echo '<span class="ellipsis">...</span>';
                }
            }

            for ($i = $start; $i <= $end; $i++) {
                if ($i === $current_page) {
                    echo "<strong>{$i}</strong>";
                } else {
                    echo "<a href='?page={$i}&keyword=" . urlencode($keyword) . "'>{$i}</a>";
                }
            }

            if ($end < $total_pages) {
                if ($end < $total_pages - 1) {
                    echo '<span class="ellipsis">...</span>';
                }
                echo "<a href='?page={$total_pages}&keyword=" . urlencode($keyword) . "'>{$total_pages}</a>";
            }
            ?>

            <!-- æ¬¡ã¸ãƒœã‚¿ãƒ³ -->
            <?php if ($current_page < $total_pages): ?>
                <a href="?page=<?php echo $current_page + 1; ?>&keyword=<?php echo urlencode($keyword); ?>">æ¬¡ã¸ Â»</a>
            <?php else: ?>
                <span class="disabled">æ¬¡ã¸ Â»</span>
            <?php endif; ?>
        </div>
    <?php endif; ?>
</body>
</html>
```

#### âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆ

1. **ãƒ—ãƒªãƒšã‚¢ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ**: LIKEæ¤œç´¢ã§ã‚‚ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’ä½¿ç”¨
2. **urlencode()**: URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¯å¿…ãš `urlencode()` ã‚’ä½¿ç”¨
3. **htmlspecialchars()**: HTMLå‡ºåŠ›ã«ã¯ `htmlspecialchars()` ã‚’ä½¿ç”¨
4. **trim()**: æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤

#### ğŸ’¡ ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆ

1. **LIKEæ¤œç´¢ã®ãƒ‘ã‚¿ãƒ¼ãƒ³**
```php
// ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
$keyword = $_GET['keyword'] ?? '';

// LIKEæ¤œç´¢ç”¨ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆéƒ¨åˆ†ä¸€è‡´ï¼‰
$search_pattern = '%' . $keyword . '%';

// ãƒ—ãƒªãƒšã‚¢ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã§å®‰å…¨ã«æ¤œç´¢
$stmt = $pdo->prepare("SELECT * FROM articles WHERE title LIKE :keyword OR content LIKE :keyword");
$stmt->bindValue(':keyword', $search_pattern, PDO::PARAM_STR);
```

2. **URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®ä½¿ã„åˆ†ã‘**
```php
// URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: urlencode()
<a href="?page=1&keyword=<?php echo urlencode($keyword); ?>">

// HTMLè¡¨ç¤º: htmlspecialchars()
<p>æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: <?php echo htmlspecialchars($keyword, ENT_QUOTES, 'UTF-8'); ?></p>
```

3. **æ¤œç´¢çµæœãŒ0ä»¶ã®å ´åˆã®å‡¦ç†**
```php
<?php if (empty($articles)): ?>
    <div class="no-results">
        <p>è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
        <?php if (!empty($keyword)): ?>
            <p><a href="?">ã™ã¹ã¦ã®è¨˜äº‹ã‚’è¡¨ç¤º</a></p>
        <?php endif; ?>
    </div>
<?php else: ?>
    <!-- è¨˜äº‹ä¸€è¦§ã‚’è¡¨ç¤º -->
<?php endif; ?>
```

#### ğŸ“ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

**LIKEæ¤œç´¢ã¨SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³**

```php
// âŒ å±é™º: ç›´æ¥SQLæ–‡ã«åŸ‹ã‚è¾¼ã‚€
$sql = "SELECT * FROM articles WHERE title LIKE '%$keyword%'";
// â†’ SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ï¼

// âœ… å®‰å…¨: ãƒ—ãƒªãƒšã‚¢ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ä½¿ã†
$search_pattern = '%' . $keyword . '%';
$stmt = $pdo->prepare("SELECT * FROM articles WHERE title LIKE :keyword");
$stmt->bindValue(':keyword', $search_pattern, PDO::PARAM_STR);
```

**LIKEæ¤œç´¢ã®ãƒ‘ã‚¿ãƒ¼ãƒ³**

```php
// éƒ¨åˆ†ä¸€è‡´ï¼ˆå‰æ–¹ãƒ»å¾Œæ–¹ä¸€è‡´ï¼‰
$search_pattern = '%' . $keyword . '%';
// ä¾‹: $keyword = 'PHP' â†’ '%PHP%' â†’ ã€ŒPHPå…¥é–€ã€ã€Œã¯ã˜ã‚ã¦ã®PHPã€ã€ŒPHPã¨MySQLã€ã™ã¹ã¦ãƒãƒƒãƒ

// å‰æ–¹ä¸€è‡´
$search_pattern = $keyword . '%';
// ä¾‹: $keyword = 'PHP' â†’ 'PHP%' â†’ ã€ŒPHPå…¥é–€ã€ã€ŒPHPã¨MySQLã€ã¯ãƒãƒƒãƒã€ã€Œã¯ã˜ã‚ã¦ã®PHPã€ã¯ãƒãƒƒãƒã—ãªã„

// å¾Œæ–¹ä¸€è‡´
$search_pattern = '%' . $keyword;
// ä¾‹: $keyword = 'PHP' â†’ '%PHP' â†’ ã€Œã¯ã˜ã‚ã¦ã®PHPã€ã¯ãƒãƒƒãƒã€ã€ŒPHPå…¥é–€ã€ã¯ãƒãƒƒãƒã—ãªã„
```

**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æ³¨æ„ç‚¹**

```sql
-- âŒ é…ã„: å‰æ–¹ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ä»˜ãLIKEæ¤œç´¢ã¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒä½¿ãˆãªã„
SELECT * FROM articles WHERE title LIKE '%PHP%';

-- âœ… é€Ÿã„: å‰æ–¹ä¸€è‡´æ¤œç´¢ã¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒä½¿ãˆã‚‹
SELECT * FROM articles WHERE title LIKE 'PHP%';

-- âœ… ã‚‚ã£ã¨é€Ÿã„: FULLTEXT ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ã†ï¼ˆæ—¥æœ¬èªå¯¾å¿œã«æ³¨æ„ï¼‰
CREATE FULLTEXT INDEX idx_fulltext ON articles(title, content);
SELECT * FROM articles WHERE MATCH(title, content) AGAINST('PHP' IN NATURAL LANGUAGE MODE);
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ£ãƒ¬ãƒ³ã‚¸

### å•é¡Œ5-7ï¼šã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ä»˜ããƒšãƒ¼ã‚¸ãƒ³ã‚°

ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ã¨ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã‚’çµ„ã¿åˆã‚ã›ã¾ã™ã€‚

#### âœ… è§£ç­”ä¾‹ï¼ˆé‡è¦éƒ¨åˆ†ã®ã¿ï¼‰

```php
<?php
require_once 'config.php';

// ã‚«ãƒ†ã‚´ãƒªã‚’å–å¾—ï¼ˆãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ï¼‰
$allowed_categories = ['ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼', 'ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«', 'ãƒ“ã‚¸ãƒã‚¹', ''];
$category = $_GET['category'] ?? '';

// ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã§ãƒã‚§ãƒƒã‚¯
if (!in_array($category, $allowed_categories, true)) {
    $category = '';
}

// ãƒšãƒ¼ã‚¸ç•ªå·ã‚’å–å¾—
$current_page = $_GET['page'] ?? 1;
$current_page = (int)$current_page;
if ($current_page < 1) {
    $current_page = 1;
}

$per_page = 10;

// SQLã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰
if (!empty($category)) {
    $sql = "SELECT * FROM articles WHERE category = :category ORDER BY created_at DESC LIMIT :limit OFFSET :offset";
    $count_sql = "SELECT COUNT(*) FROM articles WHERE category = :category";
} else {
    $sql = "SELECT * FROM articles ORDER BY created_at DESC LIMIT :limit OFFSET :offset";
    $count_sql = "SELECT COUNT(*) FROM articles";
}

// ç·ä»¶æ•°ã‚’å–å¾—
$count_stmt = $pdo->prepare($count_sql);
if (!empty($category)) {
    $count_stmt->bindValue(':category', $category, PDO::PARAM_STR);
}
$count_stmt->execute();
$total_count = (int)$count_stmt->fetchColumn();

// ç·ãƒšãƒ¼ã‚¸æ•°ã‚’è¨ˆç®—
$total_pages = ceil($total_count / $per_page);
$offset = ($current_page - 1) * $per_page;

// ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
$stmt = $pdo->prepare($sql);
if (!empty($category)) {
    $stmt->bindValue(':category', $category, PDO::PARAM_STR);
}
$stmt->bindValue(':limit', $per_page, PDO::PARAM_INT);
$stmt->bindValue(':offset', $offset, PDO::PARAM_INT);
$stmt->execute();
$articles = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>

<!-- ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿UI -->
<div class="category-filter">
    <a href="?" class="<?php echo empty($category) ? 'active' : ''; ?>">ã™ã¹ã¦</a>
    <a href="?category=<?php echo urlencode('ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼'); ?>"
       class="<?php echo $category === 'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼' ? 'active' : ''; ?>">ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼</a>
    <a href="?category=<?php echo urlencode('ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«'); ?>"
       class="<?php echo $category === 'ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«' ? 'active' : ''; ?>">ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«</a>
    <a href="?category=<?php echo urlencode('ãƒ“ã‚¸ãƒã‚¹'); ?>"
       class="<?php echo $category === 'ãƒ“ã‚¸ãƒã‚¹' ? 'active' : ''; ?>">ãƒ“ã‚¸ãƒã‚¹</a>
</div>

<!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ï¼ˆã‚«ãƒ†ã‚´ãƒªã‚’ä¿æŒï¼‰ -->
<a href="?page=<?php echo $i; ?>&category=<?php echo urlencode($category); ?>">
    <?php echo $i; ?>
</a>
```

#### âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆ

1. **ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼**: è¨±å¯ã™ã‚‹ã‚«ãƒ†ã‚´ãƒªã‚’é…åˆ—ã§å®šç¾©
2. **in_array() ã®å³å¯†æ¯”è¼ƒ**: å‹ã‚‚å«ã‚ã¦æ¯”è¼ƒ
3. **urlencode()**: URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
4. **ãƒ—ãƒªãƒšã‚¢ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ**: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–

#### ğŸ’¡ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

**ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ã®é‡è¦æ€§**

```php
// âœ… ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ï¼ˆæ¨å¥¨ï¼‰
$allowed_categories = ['ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼', 'ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«', 'ãƒ“ã‚¸ãƒã‚¹', ''];
if (!in_array($category, $allowed_categories, true)) {
    $category = '';
}

// âŒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—ï¼ˆå±é™ºï¼‰
$category = $_GET['category'] ?? '';
// â†’ SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®å¯èƒ½æ€§
```

---

### å•é¡Œ5-8ï¼šãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã®ä½œæˆ

å†åˆ©ç”¨å¯èƒ½ãªãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚

#### âœ… è§£ç­”ä¾‹

**functions.php**

```php
<?php
/**
 * ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³HTMLã‚’ç”Ÿæˆ
 *
 * @param int $current_page ç¾åœ¨ã®ãƒšãƒ¼ã‚¸
 * @param int $total_pages ç·ãƒšãƒ¼ã‚¸æ•°
 * @param array $params è¿½åŠ ã®URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆä¾‹: ['keyword' => 'PHP', 'category' => 'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼']ï¼‰
 * @param int $range ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®å‰å¾Œä½•ãƒšãƒ¼ã‚¸è¡¨ç¤ºã™ã‚‹ã‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 2ï¼‰
 * @return string ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã®HTML
 */
function generatePagination($current_page, $total_pages, $params = [], $range = 2) {
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    $current_page = (int)$current_page;
    $total_pages = (int)$total_pages;
    $range = (int)$range;

    if ($current_page < 1) {
        $current_page = 1;
    }

    if ($total_pages < 1) {
        return ''; // ãƒšãƒ¼ã‚¸ãŒãªã„å ´åˆã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„
    }

    if ($current_page > $total_pages) {
        $current_page = $total_pages;
    }

    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ§‹ç¯‰ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: http_build_query ã‚’ä½¿ã†ï¼‰
    $query_params = array_filter($params, function($value) {
        return $value !== '' && $value !== null;
    });

    $query_string = http_build_query($query_params);
    $separator = empty($query_string) ? '' : '&';

    $html = '<div class="pagination">';

    // å‰ã¸ãƒœã‚¿ãƒ³
    if ($current_page > 1) {
        $prev_url = '?page=' . ($current_page - 1) . $separator . $query_string;
        $html .= '<a href="' . htmlspecialchars($prev_url, ENT_QUOTES, 'UTF-8') . '">Â« å‰ã¸</a>';
    } else {
        $html .= '<span class="disabled">Â« å‰ã¸</span>';
    }

    // ãƒšãƒ¼ã‚¸ç•ªå·ï¼ˆçœç•¥è¡¨ç¤ºï¼‰
    $start = max(1, $current_page - $range);
    $end = min($total_pages, $current_page + $range);

    // æœ€åˆã®ãƒšãƒ¼ã‚¸
    if ($start > 1) {
        $first_url = '?page=1' . $separator . $query_string;
        $html .= '<a href="' . htmlspecialchars($first_url, ENT_QUOTES, 'UTF-8') . '">1</a>';
        if ($start > 2) {
            $html .= '<span class="ellipsis">...</span>';
        }
    }

    // ç¯„å›²å†…ã®ãƒšãƒ¼ã‚¸
    for ($i = $start; $i <= $end; $i++) {
        if ($i === $current_page) {
            $html .= "<strong>{$i}</strong>";
        } else {
            $page_url = "?page={$i}" . $separator . $query_string;
            $html .= '<a href="' . htmlspecialchars($page_url, ENT_QUOTES, 'UTF-8') . '">' . $i . '</a>';
        }
    }

    // æœ€å¾Œã®ãƒšãƒ¼ã‚¸
    if ($end < $total_pages) {
        if ($end < $total_pages - 1) {
            $html .= '<span class="ellipsis">...</span>';
        }
        $last_url = "?page={$total_pages}" . $separator . $query_string;
        $html .= '<a href="' . htmlspecialchars($last_url, ENT_QUOTES, 'UTF-8') . '">' . $total_pages . '</a>';
    }

    // æ¬¡ã¸ãƒœã‚¿ãƒ³
    if ($current_page < $total_pages) {
        $next_url = '?page=' . ($current_page + 1) . $separator . $query_string;
        $html .= '<a href="' . htmlspecialchars($next_url, ENT_QUOTES, 'UTF-8') . '">æ¬¡ã¸ Â»</a>';
    } else {
        $html .= '<span class="disabled">æ¬¡ã¸ Â»</span>';
    }

    $html .= '</div>';

    return $html;
}

// ä½¿ç”¨ä¾‹
echo generatePagination($current_page, $total_pages, [
    'keyword' => $keyword,
    'category' => $category,
    'per_page' => $per_page
]);
```

#### âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆ

1. **http_build_query()**: URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å®‰å…¨ãªæ§‹ç¯‰
2. **htmlspecialchars()**: URLå‡ºåŠ›æ™‚ã®XSSå¯¾ç­–
3. **array_filter()**: ç©ºã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é™¤å¤–
4. **å‹ã‚­ãƒ£ã‚¹ãƒˆ**: ã™ã¹ã¦ã®æ•°å€¤ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ•´æ•°åŒ–

#### ğŸ’¡ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

**http_build_query() ã®åˆ©ç‚¹**

```php
// âœ… å®‰å…¨: http_build_query() ã‚’ä½¿ã†
$params = ['keyword' => 'PHP & MySQL', 'category' => 'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼'];
$query_string = http_build_query($params);
// çµæœ: keyword=PHP+%26+MySQL&category=%E3%83%86%E3%82%AF%E3%83%8E%E3%83%AD%E3%82%B8%E3%83%BC

// âŒ å±é™º: æ‰‹å‹•ã§æ§‹ç¯‰
$query_string = "keyword={$keyword}&category={$category}";
// â†’ URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œãšã€ç‰¹æ®Šæ–‡å­—ã§å•é¡ŒãŒç™ºç”Ÿ
```

---

## ç·åˆãƒãƒ£ãƒ¬ãƒ³ã‚¸

### å•é¡Œ5-9ï¼šå®Œå…¨ãªè¨˜äº‹æ¤œç´¢ãƒ»ä¸€è¦§ã‚·ã‚¹ãƒ†ãƒ 

ã™ã¹ã¦ã®æ©Ÿèƒ½ã‚’çµ±åˆã—ãŸå®Œå…¨ãªè¨˜äº‹æ¤œç´¢ãƒ»ä¸€è¦§ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œæˆã—ã¾ã™ã€‚

#### âœ… è§£ç­”ä¾‹ï¼ˆçµ±åˆç‰ˆï¼‰

ã“ã®å•é¡Œã¯ã€ã“ã‚Œã¾ã§ã®ã™ã¹ã¦ã®æŠ€è¡“ã‚’çµ„ã¿åˆã‚ã›ãŸç·åˆçš„ãªå®Ÿè£…ã§ã™ã€‚

**index.php**ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

```php
<?php
require_once 'config.php';
require_once 'functions.php'; // generatePagination() é–¢æ•°

// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆã™ã¹ã¦ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ/ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
$keyword = $_GET['keyword'] ?? '';
$keyword = trim($keyword);

$allowed_categories = ['ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼', 'ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«', 'ãƒ“ã‚¸ãƒã‚¹', ''];
$category = $_GET['category'] ?? '';
if (!in_array($category, $allowed_categories, true)) {
    $category = '';
}

$allowed_per_page = [10, 25, 50, 100];
$per_page = (int)($_GET['per_page'] ?? 10);
if (!in_array($per_page, $allowed_per_page, true)) {
    $per_page = 10;
}

$allowed_sort = ['new', 'old'];
$sort = $_GET['sort'] ?? 'new';
if (!in_array($sort, $allowed_sort, true)) {
    $sort = 'new';
}

$current_page = (int)($_GET['page'] ?? 1);
if ($current_page < 1) {
    $current_page = 1;
}

// SQLã‚¯ã‚¨ãƒªã‚’å‹•çš„ã«æ§‹ç¯‰
$where_conditions = [];
$bind_params = [];

if (!empty($keyword)) {
    $where_conditions[] = "(title LIKE :keyword OR content LIKE :keyword)";
    $bind_params[':keyword'] = '%' . $keyword . '%';
}

if (!empty($category)) {
    $where_conditions[] = "category = :category";
    $bind_params[':category'] = $category;
}

$where_clause = !empty($where_conditions) ? 'WHERE ' . implode(' AND ', $where_conditions) : '';
$order_clause = $sort === 'new' ? 'ORDER BY created_at DESC' : 'ORDER BY created_at ASC';

// ç·ä»¶æ•°ã‚’å–å¾—
$count_sql = "SELECT COUNT(*) FROM articles {$where_clause}";
$count_stmt = $pdo->prepare($count_sql);
foreach ($bind_params as $key => $value) {
    $count_stmt->bindValue($key, $value, PDO::PARAM_STR);
}
$count_stmt->execute();
$total_count = (int)$count_stmt->fetchColumn();

// ç·ãƒšãƒ¼ã‚¸æ•°ã‚’è¨ˆç®—
$total_pages = ceil($total_count / $per_page);
if ($current_page > $total_pages && $total_pages > 0) {
    $current_page = $total_pages;
}

$offset = ($current_page - 1) * $per_page;

// ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
$sql = "SELECT * FROM articles {$where_clause} {$order_clause} LIMIT :limit OFFSET :offset";
$stmt = $pdo->prepare($sql);
foreach ($bind_params as $key => $value) {
    $stmt->bindValue($key, $value, PDO::PARAM_STR);
}
$stmt->bindValue(':limit', $per_page, PDO::PARAM_INT);
$stmt->bindValue(':offset', $offset, PDO::PARAM_INT);
$stmt->execute();
$articles = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>è¨˜äº‹æ¤œç´¢ãƒ»ä¸€è¦§ã‚·ã‚¹ãƒ†ãƒ </title>
</head>
<body>
    <h1>è¨˜äº‹æ¤œç´¢ãƒ»ä¸€è¦§</h1>

    <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form method="GET">
        <input type="text" name="keyword" value="<?php echo htmlspecialchars($keyword, ENT_QUOTES, 'UTF-8'); ?>" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢">

        <select name="category">
            <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
            <?php foreach (['ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼', 'ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«', 'ãƒ“ã‚¸ãƒã‚¹'] as $cat): ?>
                <option value="<?php echo htmlspecialchars($cat, ENT_QUOTES, 'UTF-8'); ?>"
                        <?php echo $category === $cat ? 'selected' : ''; ?>>
                    <?php echo htmlspecialchars($cat, ENT_QUOTES, 'UTF-8'); ?>
                </option>
            <?php endforeach; ?>
        </select>

        <select name="per_page">
            <?php foreach ($allowed_per_page as $option): ?>
                <option value="<?php echo $option; ?>" <?php echo $per_page === $option ? 'selected' : ''; ?>>
                    <?php echo $option; ?>ä»¶è¡¨ç¤º
                </option>
            <?php endforeach; ?>
        </select>

        <select name="sort">
            <option value="new" <?php echo $sort === 'new' ? 'selected' : ''; ?>>æ–°ç€é †</option>
            <option value="old" <?php echo $sort === 'old' ? 'selected' : ''; ?>>å¤ã„é †</option>
        </select>

        <button type="submit">æ¤œç´¢</button>
        <a href="?">ã‚¯ãƒªã‚¢</a>
    </form>

    <p>å…¨<?php echo number_format($total_count); ?>ä»¶ã®è¨˜äº‹</p>

    <!-- è¨˜äº‹ä¸€è¦§ -->
    <?php if (empty($articles)): ?>
        <p>è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
    <?php else: ?>
        <?php foreach ($articles as $article): ?>
            <article>
                <h2><?php echo htmlspecialchars($article['title'], ENT_QUOTES, 'UTF-8'); ?></h2>
                <p><?php echo htmlspecialchars($article['content'], ENT_QUOTES, 'UTF-8'); ?></p>
                <footer>
                    <?php echo htmlspecialchars($article['category'], ENT_QUOTES, 'UTF-8'); ?> |
                    <?php echo htmlspecialchars($article['created_at'], ENT_QUOTES, 'UTF-8'); ?>
                </footer>
            </article>
        <?php endforeach; ?>
    <?php endif; ?>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé–¢æ•°ã‚’ä½¿ç”¨ï¼‰ -->
    <?php
    echo generatePagination($current_page, $total_pages, [
        'keyword' => $keyword,
        'category' => $category,
        'per_page' => $per_page,
        'sort' => $sort
    ]);
    ?>
</body>
</html>
```

#### âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆ

1. **ã™ã¹ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼
2. **ãƒ—ãƒªãƒšã‚¢ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ**: å‹•çš„ãªWHEREå¥ã§ã‚‚å®‰å…¨
3. **XSSå¯¾ç­–**: ã™ã¹ã¦ã®å‡ºåŠ›ã« `htmlspecialchars()`
4. **é–¢æ•°ã®å†åˆ©ç”¨**: `generatePagination()` ã§å®‰å…¨ãªHTMLç”Ÿæˆ

#### ğŸ’¡ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

**å‹•çš„WHEREå¥ã®å®‰å…¨ãªæ§‹ç¯‰**

```php
// æ¡ä»¶ã‚’é…åˆ—ã§ç®¡ç†
$where_conditions = [];
$bind_params = [];

if (!empty($keyword)) {
    $where_conditions[] = "(title LIKE :keyword OR content LIKE :keyword)";
    $bind_params[':keyword'] = '%' . $keyword . '%';
}

if (!empty($category)) {
    $where_conditions[] = "category = :category";
    $bind_params[':category'] = $category;
}

// WHEREå¥ã‚’æ§‹ç¯‰
$where_clause = !empty($where_conditions) ? 'WHERE ' . implode(' AND ', $where_conditions) : '';

// ãƒ—ãƒªãƒšã‚¢ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã§ãƒã‚¤ãƒ³ãƒ‰
$stmt = $pdo->prepare("SELECT * FROM articles {$where_clause}");
foreach ($bind_params as $key => $value) {
    $stmt->bindValue($key, $value, PDO::PARAM_STR);
}
```

---

### å•é¡Œ5-10ï¼šç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«

JavaScriptã‚’ä½¿ã£ã¦ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å®Ÿè£…ã—ã¾ã™ï¼ˆç™ºå±•èª²é¡Œï¼‰ã€‚

#### âœ… è§£ç­”ä¾‹

**api.php**ï¼ˆJSON APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰

```php
<?php
header('Content-Type: application/json; charset=utf-8');
require_once 'config.php';

try {
    $page = (int)($_GET['page'] ?? 1);
    if ($page < 1) {
        $page = 1;
    }

    $per_page = 10;
    $offset = ($page - 1) * $per_page;

    $stmt = $pdo->prepare("SELECT * FROM articles ORDER BY created_at DESC LIMIT :limit OFFSET :offset");
    $stmt->bindValue(':limit', $per_page, PDO::PARAM_INT);
    $stmt->bindValue(':offset', $offset, PDO::PARAM_INT);
    $stmt->execute();
    $articles = $stmt->fetchAll(PDO::FETCH_ASSOC);

    // XSSå¯¾ç­–: JSONå†…ã®HTMLã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    $safe_articles = array_map(function($article) {
        return [
            'id' => (int)$article['id'],
            'title' => htmlspecialchars($article['title'], ENT_QUOTES, 'UTF-8'),
            'content' => htmlspecialchars($article['content'], ENT_QUOTES, 'UTF-8'),
            'category' => htmlspecialchars($article['category'], ENT_QUOTES, 'UTF-8'),
            'created_at' => htmlspecialchars($article['created_at'], ENT_QUOTES, 'UTF-8')
        ];
    }, $articles);

    echo json_encode([
        'success' => true,
        'articles' => $safe_articles,
        'page' => $page
    ], JSON_UNESCAPED_UNICODE);

} catch (PDOException $e) {
    http_response_code(500);
    echo json_encode([
        'success' => false,
        'error' => 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'
    ], JSON_UNESCAPED_UNICODE);
}
```

**index.html**ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« - è¨˜äº‹ä¸€è¦§</title>
    <style>
        .article { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; }
        .loading { text-align: center; padding: 20px; }
    </style>
</head>
<body>
    <h1>è¨˜äº‹ä¸€è¦§ï¼ˆç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰</h1>
    <div id="articles"></div>
    <div id="loading" class="loading" style="display:none;">èª­ã¿è¾¼ã¿ä¸­...</div>

    <script>
    let currentPage = 1;
    let isLoading = false;

    // è¨˜äº‹ã‚’èª­ã¿è¾¼ã‚€
    async function loadArticles() {
        if (isLoading) return;

        isLoading = true;
        document.getElementById('loading').style.display = 'block';

        try {
            const response = await fetch(`api.php?page=${currentPage}`);
            const data = await response.json();

            if (data.success && data.articles.length > 0) {
                const container = document.getElementById('articles');

                data.articles.forEach(article => {
                    const articleEl = document.createElement('div');
                    articleEl.className = 'article';
                    // ãƒ‡ãƒ¼ã‚¿ã¯ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ¸ˆã¿
                    articleEl.innerHTML = `
                        <h2>${article.title}</h2>
                        <p>${article.content}</p>
                        <footer>${article.category} | ${article.created_at}</footer>
                    `;
                    container.appendChild(articleEl);
                });

                currentPage++;
            }
        } catch (error) {
            console.error('ã‚¨ãƒ©ãƒ¼:', error);
        } finally {
            isLoading = false;
            document.getElementById('loading').style.display = 'none';
        }
    }

    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆ
    window.addEventListener('scroll', () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
            loadArticles();
        }
    });

    // åˆå›èª­ã¿è¾¼ã¿
    loadArticles();
    </script>
</body>
</html>
```

#### âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆ

1. **ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—**: JSONå‡ºåŠ›å‰ã« `htmlspecialchars()`
2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éš ã™
3. **JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `Content-Type: application/json` ã‚’æ˜ç¤º
4. **XSSå¯¾ç­–**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã‚‚ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨

#### ğŸ’¡ å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ

**JSON APIã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**

```php
// âœ… å®‰å…¨: ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ã‹ã‚‰JSONåŒ–
$safe_articles = array_map(function($article) {
    return [
        'title' => htmlspecialchars($article['title'], ENT_QUOTES, 'UTF-8'),
        'content' => htmlspecialchars($article['content'], ENT_QUOTES, 'UTF-8')
    ];
}, $articles);
echo json_encode($safe_articles);

// âŒ å±é™º: ç”Ÿã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONåŒ–
echo json_encode($articles);
// â†’ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§XSSè„†å¼±æ€§ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§
```

---

## ã¾ã¨ã‚ ğŸ‰

**Lesson 05ã§å­¦ã‚“ã ã“ã¨**

âœ… **åŸºç¤ç·¨**
- LIMIT/OFFSETã‚’ä½¿ã£ãŸåŸºæœ¬çš„ãªãƒšãƒ¼ã‚¸ãƒ³ã‚°
- ç·ãƒšãƒ¼ã‚¸æ•°ã®è¨ˆç®—ã¨ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯
- å‰ã¸ãƒ»æ¬¡ã¸ãƒœã‚¿ãƒ³ã®å®Ÿè£…

âœ… **å¿œç”¨ç·¨**
- çœç•¥è¡¨ç¤ºï¼ˆ...ï¼‰ã‚’ä½¿ã£ãŸåŠ¹ç‡çš„ãªãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
- è¡¨ç¤ºä»¶æ•°ã®å¤‰æ›´æ©Ÿèƒ½
- æ¤œç´¢æ©Ÿèƒ½ã¨ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã®çµ„ã¿åˆã‚ã›

âœ… **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
- ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼ã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ—ãƒªãƒšã‚¢ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã§ã®SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–
- urlencode() ã¨ htmlspecialchars() ã®ä½¿ã„åˆ†ã‘

âœ… **ç·åˆ**
- å†åˆ©ç”¨å¯èƒ½ãªé–¢æ•°ã®ä½œæˆ
- è¤‡æ•°ã®æ¡ä»¶ã‚’çµ„ã¿åˆã‚ã›ãŸæ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ 
- ç„¡é™ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚‹ãƒ¢ãƒ€ãƒ³ãªUI

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**

ãƒšãƒ¼ã‚¸ãƒ³ã‚°å‡¦ç†ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ãŸã‚‰ã€æ¬¡ã¯ï¼š
1. **Phase 6**: å®Ÿè·µãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§çµ±åˆçš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰
2. **Phase 7**: REST APIã§ã•ã‚‰ã«ç™ºå±•çš„ãªå®Ÿè£…ã«æŒ‘æˆ¦

**Let's vibe and code! ğŸš€**

