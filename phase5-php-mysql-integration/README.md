# Phase 5: PHP + MySQL統合編 - 動的Webアプリケーション開発 🔗

**学習目標**：PHPからMySQLを操作し、セキュアで実用的な動的Webアプリケーションを構築できるようになる！

---

## 📖 このPhaseで学ぶこと

Phase 5では、これまで学んだ**PHP（Phase 1-2）**と**MySQL（Phase 3-4）**を統合して、**動的なWebアプリケーション**を作ります！

- **データベース接続**：PDOを使った安全で効率的な接続方法
- **プリペアドステートメント**：SQLインジェクション対策の必須技術🔒
- **CRUD操作の実装**：PHPからデータベースを操作する実践的なコード
- **5大セキュリティ対策**：XSS、CSRF、パスワードハッシュ化、セッション管理🔒
- **ページング処理**：大量データを効率的に表示する技術

**Phase 1-4との関係**：

- **Phase 1（PHP基礎）**：PHPの文法、フォーム処理、変数・配列
- **Phase 2（PHP発展）**：セッション管理、ファイル操作、エラーハンドリング
- **Phase 3（MySQL基礎）**：CRUD操作、テーブル設計、データ型
- **Phase 4（MySQL発展）**：JOIN、集計関数、トランザクション、サブクエリ
- **→ Phase 5でこれらすべてを統合！バックエンド開発の集大成！**

---

## 🎯 Phase 5の全体像

### なぜPHP + MySQL統合を学ぶの？

これまで、PHPとMySQLを別々に学んできたね！でも、実際のWebアプリケーションでは、**PHPとMySQLを組み合わせて使う**のが当たり前なんだ。

**Phase 5はバックエンド開発の集大成！**

#### 静的サイト vs 動的Webアプリケーション

**静的サイト（HTMLのみ）**：
- ❌ すべてのページをHTMLで手書き
- ❌ データ更新のたびにHTMLを編集
- ❌ ユーザーごとに異なる内容を表示できない
- ❌ ログイン機能、コメント機能が作れない

**動的Webアプリケーション（PHP + MySQL）**：
- ✅ データベースからデータを取得して自動生成
- ✅ ユーザーが投稿した内容をデータベースに保存
- ✅ ユーザーごとに異なる内容を表示（ログイン、マイページ）
- ✅ リアルタイムに更新される（ブログ、SNS、ECサイト）

#### 実際の使用例

**ブログシステム**：
- PHPでブログ記事をデータベースから取得
- ユーザーがコメントを投稿 → データベースに保存
- 記事一覧をページング表示（1ページ10件）

**ECサイト**：
- 商品データをデータベースで管理
- ユーザーがカートに追加 → セッションとデータベースで管理
- 在庫数を更新（トランザクション処理）

**SNS**：
- ユーザーの投稿をデータベースに保存
- タイムラインをSELECTで取得
- いいね、コメント機能

### Phase 5のゴール

このPhaseを終えると、こんなことができるようになるよ！

- 🔌 **PDOでデータベース接続**：エラーハンドリング、設定ファイルの分離
- 🔒 **SQLインジェクション対策**：プリペアドステートメントの完全理解
- 📝 **CRUD操作**：PHPから安全にデータベースを操作
- 🛡️ **5大セキュリティ対策**：XSS、CSRF、パスワード保護、セッション管理、入力バリデーション
- 📄 **ページング処理**：大量データを効率的に表示
- 🏗️ **実用的なアプリケーション構築**：ブログシステム、タスク管理システム
- 🤖 **AIに的確なセキュリティ指示**：セキュアなコード生成を依頼できる
- 🔍 **生成コードのセキュリティチェック**：脆弱性を発見・修正できる

---

## 📚 レッスン一覧

### Lesson 01: データベース接続 🔌

**学習時間の目安**：2-3時間

**何を学ぶ？**

- PDO（PHP Data Objects）とは
- データベース接続の基本（DSN、ユーザー名、パスワード）
- 接続オプションの設定（エラーモード、文字エンコーディング）
- エラーハンドリング（try-catch）
- 設定ファイルの分離（config.php）
- MAMP環境での接続設定

**このレッスンのポイント**

データベース接続は、すべての動的Webアプリケーションの**入り口**！PDOを使って安全に接続する方法を学ぼう。設定ファイルを分離することで、コードの保守性が向上するよ！

**バイブコーダー向けポイント**

- 「MAMP環境でMySQLに接続するPDOのコードを書いて」とAIに指示できる
- AIが生成した接続コードのエラーハンドリングをチェックできる
- セキュアな接続オプション（ATTR_ERRMODE、ATTR_EMULATE_PREPARES）を指定できる

👉 **[Lesson 01の詳細を見る](lessons/01-connection/README.md)**

---

### Lesson 02: プリペアドステートメント 🔒

**学習時間の目安**：3-4時間

**何を学ぶ？**

- SQLインジェクションとは何か（攻撃例）
- プリペアドステートメントの仕組み
- prepare()、bindParam()、execute()の使い方
- 名前付きプレースホルダー（:name）と疑問符プレースホルダー（?）
- プリペアドステートメントでCRUD操作
- fetch()とfetchAll()の使い分け
- lastInsertId()、rowCount()の活用

**このレッスンのポイント**

**プリペアドステートメントはセキュリティの要**！SQLインジェクション攻撃を防ぐために**絶対に必須**の技術。AIが生成したコードに脆弱性がないかチェックできるようになろう！

**バイブコーダー向けポイント**

- 「プリペアドステートメントでSELECTを書いて」とAIに明確に指示できる
- AIが生成したコードが直接SQL文に変数を埋め込んでいないかチェックできる
- prepare() → bindParam() → execute()の流れを理解して指示できる

👉 **[Lesson 02の詳細を見る](lessons/02-prepared-statements/README.md)**

---

### Lesson 03: CRUD操作の実装 📝

**学習時間の目安**：4-5時間

**何を学ぶ？**

- PHPからのCRUD操作（Create、Read、Update、Delete）
- フォームデータの受け取りとデータベース保存
- データ取得と一覧表示
- データ更新（編集フォーム、初期値設定）
- データ削除（確認メッセージ、CSRF対策）
- バリデーション（入力チェック）
- リダイレクト処理（PRGパターン）
- トランザクション処理の基礎

**このレッスンのポイント**

CRUD操作は、**Webアプリケーション開発の核心**！ブログ、SNS、ECサイトなど、すべてのアプリケーションはCRUDで成り立っている。セキュアなCRUD操作を実装できるようになろう！

**バイブコーダー向けポイント**

- 「商品登録フォームを作成して、プリペアドステートメントでINSERTして」と指示できる
- AIが生成したコードのバリデーション、エラーハンドリングをチェックできる
- フォームの初期値設定、リダイレクト処理を理解して指示できる

👉 **[Lesson 03の詳細を見る](lessons/03-crud-operations/README.md)**

---

### Lesson 04: セキュリティ対策 🔒

**学習時間の目安**：4-5時間

**何を学ぶ？**

- **5大セキュリティ対策**の完全理解
  1. **SQLインジェクション対策**：プリペアドステートメント
  2. **XSS対策**：htmlspecialchars()の正しい使い方
  3. **CSRF対策**：CSRFトークンの生成・検証
  4. **パスワード保護**：password_hash()、password_verify()
  5. **セッション管理**：session_regenerate_id()、セッションハイジャック対策
- OWASP Top 10の理解
- セキュアクッキーの設定（httponly、secure、samesite）
- 入力バリデーションの実装
- エラーハンドリングとログ記録

**このレッスンのポイント**

**セキュリティは後回しにできない！** 最初からセキュアなコードを書くことが重要。AIが生成したコードに脆弱性がないか、自分でチェックできるスキルを身につけよう！

**バイブコーダー向けポイント**

- 「5大セキュリティ対策をすべて実装したユーザー登録ページを作成して」と指示できる
- AIが生成したコードのセキュリティチェックができる
- OWASP Top 10の脆弱性を理解して、AIに対策を指示できる

👉 **[Lesson 04の詳細を見る](lessons/04-security/README.md)**

---

### Lesson 05: ページング処理 📄

**学習時間の目安**：3-4時間

**何を学ぶ？**

- ページングの必要性（大量データの効率的表示）
- LIMITとOFFSETの使い方
- 総ページ数の計算（COUNT(*)、ceil()）
- ページネーションリンクの実装（前へ、次へ、ページ番号）
- 省略表示（...）の実装
- 検索結果のページング
- URLパラメータでの状態管理
- パフォーマンス最適化（インデックス、COUNT(*)のキャッシュ）

**このレッスンのポイント**

大量データを扱うアプリケーションには**ページングが必須**！ユーザーフレンドリーなページネーションを実装できるようになろう。検索機能との組み合わせも重要だよ！

**バイブコーダー向けポイント**

- 「記事一覧にページング機能を実装して（1ページ10件、省略表示あり）」と指示できる
- AIが生成したページング処理のOFFSET計算が正しいかチェックできる
- URLパラメータでの状態管理を理解して指示できる

👉 **[Lesson 05の詳細を見る](lessons/05-pagination/README.md)**

---

## 🏗️ 総合プロジェクト

Phase 5の学習を終えたら、以下のプロジェクトに挑戦しよう！

### プロジェクト1: ブログシステム（blog-system）

**機能**：
- ユーザー登録・ログイン（パスワードハッシュ化、セッション管理）
- 記事投稿・編集・削除（CRUD操作、CSRF対策）
- 記事一覧表示（ページング、検索機能）
- コメント機能（外部キー、バリデーション）
- カテゴリ別表示（JOIN）

**学べること**：
- 5大セキュリティ対策の統合
- ユーザー認証・認可の実装
- 複数テーブルの連携（JOIN）
- 実用的なアプリケーション設計

👉 **[ブログシステムの詳細を見る](projects/blog-system/README.md)**

---

### プロジェクト2: タスク管理システム（task-manager）

**機能**：
- タスクの作成・編集・削除（CRUD操作）
- タスクのステータス管理（未完了、進行中、完了）
- 期限管理（日付型、並び替え）
- タスクの検索・フィルタ（複数条件）
- ページング処理

**学べること**：
- ステータス管理の実装
- 日付型データの扱い方
- 複雑な検索条件の組み合わせ
- トランザクション処理

👉 **[タスク管理システムの詳細を見る](projects/task-manager/README.md)**

---

## 🎓 Phase 5を終えたら...

Phase 5を完了すると、以下のスキルが身につきます：

### 技術スキル

✅ **データベース操作**
- PDOでの安全な接続
- プリペアドステートメントの完全理解
- CRUD操作の実装

✅ **セキュリティ**
- SQLインジェクション、XSS、CSRF対策
- パスワードハッシュ化、セッション管理
- OWASP Top 10の理解

✅ **実践的な機能実装**
- ユーザー認証・認可
- ページング処理
- 検索機能

### バイブコーディングスキル

✅ **AIへの的確な指示**
- セキュリティ要件を含めた指示ができる
- 技術用語を使った明確な指示ができる
- 段階的な実装を依頼できる

✅ **コードレビュー力**
- AIが生成したコードのセキュリティチェックができる
- 脆弱性を発見し、修正指示ができる
- ベストプラクティスに沿っているか評価できる

### 次のステップ

**Phase 6: 実践プロジェクト 🏗️**
- Phase 1-5の知識を統合した大規模プロジェクト
- チーム開発の基礎
- デプロイとサーバー管理

**Phase 7: REST API開発 🌐** （オプション）
- RESTful APIの設計と実装
- JSON形式のデータ送受信
- 認証トークン（JWT）

---

## 💡 Phase 5学習のヒント

### 学習の進め方

1. **各レッスンを順番に学習**
   - Phase 5は積み重ねが重要！飛ばさずに順番に進めよう

2. **コードを実際に動かす**
   - MAMP環境で自分の手で動かすことが最重要
   - エラーが出たら、エラーメッセージを読んで解決しよう

3. **演習問題にすべて挑戦**
   - 基礎編 → 応用編 → セキュリティチャレンジ → 総合チャレンジ
   - 解答例を見る前に自分で考えてみよう

4. **セキュリティを最優先**
   - 「動けばOK」ではなく、「セキュアに動く」を目指そう
   - すべてのコードでセキュリティチェックリストを確認

5. **AIと協働**
   - AIに指示を出して、生成されたコードをレビューする練習
   - 脆弱性を見つけたら、修正指示を出してみよう

### よくある質問

**Q: Phase 1-4を完璧にしてからPhase 5に進むべき？**

A: 基本的な理解があればOK！Phase 5を進めながら、必要に応じてPhase 1-4を復習しよう。実践を通じて理解が深まるよ！

**Q: セキュリティ対策が難しい...**

A: 最初は「5大セキュリティ対策のチェックリスト」を毎回確認しよう。繰り返すうちに自然と身につくよ！AIに指示する時も、必ずセキュリティ要件を含めることが重要！

**Q: プリペアドステートメントを使わないとどうなる？**

A: SQLインジェクション攻撃を受けて、**データベース全体が破壊される**可能性がある！絶対にプリペアドステートメントを使おう！

**Q: AIが生成したコードをどこまで信頼していい？**

A: AIは便利だけど、**セキュリティチェックは必須**！このPhaseで学ぶセキュリティチェックリストを使って、必ず自分で確認しよう！

---

## 🤖 バイブコーダーとしての心構え

### AIと協働する時の重要ポイント

**1. セキュリティ要件を必ず含める**

```text
❌ 悪い指示：「ユーザー登録ページを作成して」

✅ 良い指示：「ユーザー登録ページを作成してください。
要件：
- プリペアドステートメントでSQLインジェクション対策
- password_hash()でパスワードハッシュ化
- CSRFトークンを実装
- htmlspecialchars()でXSS対策
- バリデーション（ユーザー名、メールアドレス、パスワード）」
```

**2. 生成されたコードを必ずチェック**

セキュリティチェックリスト：
- [ ] SQLインジェクション対策：プリペアドステートメント使用？
- [ ] XSS対策：htmlspecialchars()使用？
- [ ] CSRF対策：トークン検証あり？
- [ ] パスワード保護：password_hash()使用？
- [ ] セッション管理：session_regenerate_id()使用？

**3. エラーから学ぶ**

エラーは**成長のチャンス**！エラーメッセージを読んで、原因を理解しよう。AIに「このエラーの原因と修正方法を教えて」と聞いてもOK！

---

## 📚 参考資料

### 公式ドキュメント

- [PHP公式マニュアル](https://www.php.net/manual/ja/)
- [PDOクラス](https://www.php.net/manual/ja/class.pdo.php)
- [MySQL公式ドキュメント](https://dev.mysql.com/doc/)

### セキュリティ

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [OWASP Cheat Sheet Series](https://cheatsheetseries.owasp.org/)

---

**Let's vibe and code! 🎉**

Phase 5はバックエンド開発の集大成！セキュアで実用的なWebアプリケーションを作れるようになろう！
